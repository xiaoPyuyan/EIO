<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è›‹åº“ç®¡ç†ç³»ç»Ÿ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- å¼•å…¥SheetJSåº“ç”¨äºExcelå¯¼å‡º -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        /* ä¹‹å‰çš„CSSæ ·å¼ä¿æŒä¸å˜ï¼Œè¿™é‡Œåªå±•ç¤ºå®Œæ•´çš„CSSä»£ç  */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 22px 0;
            border-radius: 10px;
            margin-bottom: 22px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            font-size: 1.9rem;
            margin-bottom: 6px;
        }
        
        header p {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        nav {
            display: flex;
            background-color: white;
            border-radius: 10px;
            margin-bottom: 22px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            flex-wrap: wrap;
        }
        
        .nav-btn {
            flex: 1;
            min-width: 140px;
            padding: 16px 18px;
            text-align: center;
            background: none;
            border: none;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #555;
        }
        
        .nav-btn:hover {
            background-color: #f0f5ff;
            color: #2575fc;
        }
        
        .nav-btn.active {
            background-color: #2575fc;
            color: white;
        }
        
        .section {
            display: none;
            background-color: white;
            border-radius: 10px;
            padding: 22px;
            margin-bottom: 22px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }
        
        .section.active {
            display: block;
        }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 18px;
            color: #2575fc;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f5ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title .btn-group {
            display: flex;
            gap: 8px;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            margin-bottom: 18px;
        }
        
        .form-group {
            flex: 1 1 280px;
        }
        
        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #444;
            font-size: 0.9rem;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 11px 14px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: #2575fc;
            outline: none;
            box-shadow: 0 0 0 2px rgba(37, 117, 252, 0.2);
        }
        
        .btn {
            padding: 11px 22px;
            background-color: #2575fc;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background-color: #1a68e8;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(37, 117, 252, 0.3);
        }
        
        .btn-danger {
            background-color: #ff4757;
        }
        
        .btn-danger:hover {
            background-color: #ff3742;
            box-shadow: 0 4px 8px rgba(255, 71, 87, 0.3);
        }
        
        .btn-success {
            background-color: #2ed573;
        }
        
        .btn-success:hover {
            background-color: #25c464;
            box-shadow: 0 4px 8px rgba(46, 213, 115, 0.3);
        }
        
        .btn-warning {
            background-color: #ffa502;
        }
        
        .btn-warning:hover {
            background-color: #e59400;
            box-shadow: 0 4px 8px rgba(255, 165, 2, 0.3);
        }
        
        .btn-secondary {
            background-color: #6c757d;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
            box-shadow: 0 4px 8px rgba(108, 117, 125, 0.3);
        }
        
        .password-group {
            background-color: #f9f9f9;
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 22px;
            border-left: 4px solid #2575fc;
        }
        
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
            gap: 18px;
            margin-bottom: 28px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
            border-top: 4px solid #2575fc;
        }
        
        .card h3 {
            font-size: 1rem;
            color: #555;
            margin-bottom: 14px;
        }
        
        .card .value {
            font-size: 2rem;
            font-weight: 700;
            color: #2575fc;
        }
        
        .chart-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
            gap: 22px;
            margin-bottom: 28px;
        }
        
        .chart-box {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
        }
        
        .chart-box h3 {
            font-size: 1.1rem;
            margin-bottom: 18px;
            color: #444;
            text-align: center;
        }
        
        .search-box {
            background-color: #f9f9f9;
            padding: 18px;
            border-radius: 8px;
            margin-top: 18px;
            margin-bottom: 18px;
        }
        
        /* åº“å­˜ä¿¡æ¯è¡¨æ ¼å®¹å™¨ - æ·»åŠ æ»šåŠ¨æ¡ */
        .table-scroll-container {
            overflow: auto;
            max-height: 600px;
            margin-top: 14px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        
        .table-scroll-container table {
            width: 100%;
            min-width: 1200px; /* ç¡®ä¿è¡¨æ ¼è¶³å¤Ÿå®½ä»¥æ˜¾ç¤ºæ‰€æœ‰åˆ— */
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85rem;
        }
        
        th, td {
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
            white-space: nowrap; /* é˜²æ­¢æ–‡æœ¬æ¢è¡Œ */
        }
        
        th {
            background-color: #f5f7fa;
            font-weight: 600;
            color: #444;
            font-size: 0.9rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        .empty-state {
            text-align: center;
            padding: 36px 18px;
            color: #888;
        }
        
        .empty-state i {
            font-size: 2.8rem;
            margin-bottom: 14px;
            opacity: 0.5;
        }
        
        footer {
            text-align: center;
            padding: 22px 0;
            margin-top: 28px;
            color: #666;
            border-top: 1px solid #eee;
            font-size: 0.85rem;
        }
        
        .clear-data-btn {
            margin-top: 28px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .data-count {
            color: #2575fc;
            font-weight: 600;
        }
        
        .export-buttons {
            display: flex;
            gap: 8px;
            margin-top: 18px;
            flex-wrap: wrap;
        }
        
        .message {
            padding: 11px 14px;
            border-radius: 6px;
            margin-bottom: 18px;
            display: none;
            font-size: 0.9rem;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .filter-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 14px;
            margin-bottom: 18px;
        }
        
        .filter-controls .form-group {
            flex: 1;
            min-width: 180px;
        }
        
        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 18px;
            margin-bottom: 28px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
            border-top: 4px solid #2575fc;
        }
        
        .stat-card h3 {
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .stat-card .value {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 4px;
            color: #2575fc;
        }
        
        .stat-card .subtitle {
            font-size: 0.85rem;
            color: #888;
        }
        
        .batch-id-display {
            background-color: #f0f5ff;
            padding: 14px;
            border-radius: 6px;
            margin-bottom: 18px;
            border-left: 4px solid #2575fc;
        }
        
        .batch-id-display .label {
            font-weight: 600;
            color: #444;
            margin-bottom: 4px;
            font-size: 0.9rem;
        }
        
        .batch-id-display .value {
            font-size: 1.2rem;
            color: #2575fc;
            font-weight: 700;
            font-family: monospace;
        }
        
        .batch-id-display .hint {
            font-size: 0.85rem;
            color: #666;
            margin-top: 4px;
        }
        
        .storage-time {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .storage-time.low {
            background-color: #d4edda;
            color: #155724;
        }
        
        .storage-time.medium {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .storage-time.high {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .storage-days {
            font-weight: 600;
        }
        
        /* æ–°å¢æ ·å¼ï¼šå‡ºåº“å•å…ƒæ ·å¼ */
        .outbound-unit {
            background-color: #f9f9f9;
            padding: 18px;
            border-radius: 8px;
            margin-bottom: 18px;
            border: 1px solid #e9ecef;
        }
        
        .outbound-unit h4 {
            margin-bottom: 14px;
            color: #444;
            font-size: 1rem;
            display: flex;
            align-items: center;
        }
        
        .outbound-unit h4 .unit-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 22px;
            height: 22px;
            background-color: #2575fc;
            color: white;
            border-radius: 50%;
            margin-right: 8px;
            font-size: 0.85rem;
        }
        
        .re-import-form {
            background-color: #f0f8ff;
            padding: 18px;
            border-radius: 8px;
            margin-top: 18px;
            border-left: 4px solid #2ed573;
            display: none;
        }
        
        .re-import-form.active {
            display: block;
        }
        
        .action-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        .strain-card {
            background: white;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            text-align: center;
            border-top: 4px solid;
        }
        
        .strain-card.hailan-brown {
            border-top-color: #6A89CC;
        }
        
        .strain-card.hailan-white {
            border-top-color: #4A69BD;
        }
        
        .strain-card.hailan-pink {
            border-top-color: #FF6B6B;
        }
        
        .strain-card.hailan-gray {
            border-top-color: #96CEB4;
        }
        
        .strain-card .value {
            font-size: 1.6rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .strain-card.hailan-brown .value {
            color: #6A89CC;
        }
        
        .strain-card.hailan-white .value {
            color: #4A69BD;
        }
        
        .strain-card.hailan-pink .value {
            color: #FF6B6B;
        }
        
        .strain-card.hailan-gray .value {
            color: #96CEB4;
        }
        
        /* ä¼˜åŒ–åçš„dashboard-gridå¸ƒå±€ */
        .dashboard-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 18px;
            margin-bottom: 28px;
        }
        
        .total-card {
            flex: 1;
            min-width: 230px;
            background: linear-gradient(135deg, #f5f7fa 0%, #e9efff 100%);
            border-top: 6px solid #2575fc;
        }
        
        .total-card .value {
            font-size: 2.2rem;
            color: #2575fc;
        }
        
        .strain-card {
            flex: 1;
            min-width: 180px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .strain-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .strain-card h3 {
            font-size: 0.95rem;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .strain-card .value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .strain-card .subtitle {
            font-size: 0.85rem;
            color: #888;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }
        
        .modal-overlay.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            padding: 28px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 14px;
            border-bottom: 2px solid #f0f5ff;
        }
        
        .modal-header h3 {
            color: #2575fc;
            margin: 0;
            font-size: 1.2rem;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: #666;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .modal-close:hover {
            background-color: #f5f7fa;
        }
        
        /* æ–°å¢åº“å­˜è­¦æŠ¥æ ·å¼ */
        .inventory-alert {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-left: 8px;
        }
        
        .inventory-alert.low {
            background-color: #ff4757;
            color: white;
        }
        
        .inventory-alert.high {
            background-color: #ff4757;
            color: white;
        }
        
        .inventory-alert.normal {
            background-color: #2ed573;
            color: white;
        }
        
        /* ä¿®æ”¹æ¨¡æ€æ¡†æ ·å¼ */
        #edit-inventory-modal .modal-content {
            max-width: 700px;
        }
        
        .edit-form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .edit-form-group {
            flex: 1 1 300px;
        }
        
        .edit-batch-display {
            background-color: #f0f5ff;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #2575fc;
        }
        
        .edit-batch-display .label {
            font-weight: 600;
            color: #444;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .edit-batch-display .value {
            font-size: 1.1rem;
            color: #2575fc;
            font-weight: 700;
        }
        
        /* æ–°å¢æ ·å¼ï¼šé€‰æ‹©åˆ é™¤åŠŸèƒ½ */
        .delete-selected-btn {
            margin-bottom: 15px;
        }
        
        .select-all-checkbox {
            margin-right: 5px;
        }
        
        .row-checkbox {
            margin-right: 10px;
        }
        
        /* æ–°å¢ï¼šå‡ºåº“è®°å½•è¡¨æ ¼å®¹å™¨æ»šåŠ¨æ¡ */
        .outbound-table-scroll-container {
            overflow: auto;
            max-height: 600px;
            margin-top: 14px;
            border: 1px solid #eee;
            border-radius: 8px;
        }
        
        .outbound-table-scroll-container table {
            width: 100%;
            min-width: 1800px; /* å‡ºåº“è®°å½•è¡¨æ ¼æ›´å®½ï¼ŒåŒ…å«æ›´å¤šå­—æ®µ */
        }
        
        /* æ–°å¢ï¼šå¤‡ä»½æ¢å¤æŒ‰é’®æ ·å¼ */
        .backup-section {
            background-color: #f0f8ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #2575fc;
        }
        
        .backup-section h3 {
            margin-bottom: 15px;
            color: #2575fc;
        }
        
        .backup-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        /* æ–‡ä»¶ä¸Šä¼ æŒ‰é’®æ ·å¼ */
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        
        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        /* =========================== */
        /* è§¦æ‘¸ä¼˜åŒ–CSS */
        /* =========================== */
        @media (hover: none) and (pointer: coarse) {
            .btn, input, select, textarea {
                min-height: 44px; /* è‹¹æœè§¦æ‘¸æŒ‡å—æ¨è */
                font-size: 16px;  /* é˜²æ­¢iOSç¼©æ”¾ */
            }
            
            .nav-btn {
                padding: 20px 15px; /* æ›´å¤§è§¦æ‘¸åŒºåŸŸ */
            }
            
            /* è¡¨æ ¼è§¦æ‘¸æ»šåŠ¨ */
            .table-scroll-container {
                -webkit-overflow-scrolling: touch;
            }
            
            /* æ¨¡æ€æ¡†æŒ‰é’®ä¼˜åŒ– */
            .modal-close {
                min-height: 44px;
                min-width: 44px;
            }
            
            /* æŒ‰é’®é—´è·ä¼˜åŒ– */
            .btn-group {
                gap: 10px !important;
            }
            
            /* è¡¨æ ¼æ“ä½œæŒ‰é’®ä¼˜åŒ– */
            .action-buttons .btn-small {
                min-height: 36px;
                padding: 8px 12px;
                font-size: 14px;
            }
            
            /* è¡¨å•å…ƒç´ è§¦æ‘¸ä¼˜åŒ– */
            input[type="date"], 
            input[type="number"], 
            input[type="text"], 
            select {
                padding: 12px 16px;
            }
            
            /* è§¦æ‘¸è®¾å¤‡ä¸Šçš„æ‚¬åœæ•ˆæœæ›¿ä»£ */
            .nav-btn:active {
                background-color: #f0f5ff;
                color: #2575fc;
            }
            
            .btn:active {
                transform: translateY(-1px);
                box-shadow: 0 2px 4px rgba(37, 117, 252, 0.3);
            }
            
            .btn-danger:active {
                box-shadow: 0 2px 4px rgba(255, 71, 87, 0.3);
            }
            
            .btn-success:active {
                box-shadow: 0 2px 4px rgba(46, 213, 115, 0.3);
            }
            
            .btn-warning:active {
                box-shadow: 0 2px 4px rgba(255, 165, 2, 0.3);
            }
            
            .btn-secondary:active {
                box-shadow: 0 2px 4px rgba(108, 117, 125, 0.3);
            }
            
            /* ä¼˜åŒ–å¡ç‰‡è§¦æ‘¸åŒºåŸŸ */
            .strain-card:active {
                transform: translateY(-2px);
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
            }
        }
        
        /* =========================== */
        /* æ¨ªå±/ç«–å±é€‚é… */
        /* =========================== */
        /* ç«–å± */
        @media (orientation: portrait) {
            .chart-container {
                grid-template-columns: 1fr;
            }
            
            .dashboard-grid {
                flex-direction: column;
            }
            
            .total-card, .strain-card {
                min-width: 100%;
            }
            
            /* ç«–å±æ—¶è°ƒæ•´å¯¼èˆªæŒ‰é’® */
            .nav-btn {
                min-width: 25%;
                padding: 18px 10px;
                font-size: 0.85rem;
            }
            
            /* ç«–å±æ—¶è°ƒæ•´æ¨¡æ€æ¡†å®½åº¦ */
            .modal-content {
                width: 95%;
                padding: 20px;
            }
            
            /* ç«–å±æ—¶è°ƒæ•´è¡¨æ ¼å®¹å™¨é«˜åº¦ */
            .table-scroll-container,
            .outbound-table-scroll-container {
                max-height: 400px;
            }
        }
        
        /* æ¨ªå± */
        @media (orientation: landscape) {
            .dashboard-grid {
                flex-wrap: nowrap;
            }
            
            /* æ¨ªå±æ—¶è°ƒæ•´å¯¼èˆªæŒ‰é’® */
            .nav-btn {
                min-width: 140px;
                padding: 16px 18px;
            }
            
            /* æ¨ªå±æ—¶è°ƒæ•´å›¾è¡¨å®¹å™¨ */
            .chart-container {
                grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            }
            
            /* æ¨ªå±æ—¶è°ƒæ•´å‡ºåº“å•å…ƒå¸ƒå±€ */
            .outbound-unit .form-row {
                flex-wrap: nowrap;
            }
            
            /* æ¨ªå±æ—¶è°ƒæ•´ç­›é€‰æ§ä»¶ */
            .filter-controls {
                flex-wrap: nowrap;
            }
        }
        
        /* =========================== */
        /* é€šç”¨å“åº”å¼è®¾è®¡ */
        /* =========================== */
        @media (max-width: 1200px) {
            .strain-card {
                min-width: 160px;
            }
            
            .chart-container {
                grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            }
        }
        
        @media (max-width: 992px) {
            .dashboard-grid {
                flex-direction: column;
            }
            
            .total-card, .strain-card {
                min-width: 100%;
            }
            
            .chart-container {
                grid-template-columns: 1fr;
            }
            
            /* ä¸­å±è®¾å¤‡è§¦æ‘¸ä¼˜åŒ– */
            .nav-btn {
                padding: 18px 12px;
            }
            
            .filter-controls {
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 768px) {
            .chart-container {
                grid-template-columns: 1fr;
            }
            
            .form-group {
                flex: 1 1 100%;
            }
            
            .container {
                padding: 14px;
            }
            
            header h1 {
                font-size: 1.6rem;
            }
            
            .nav-btn {
                min-width: 110px;
                padding: 14px 8px;
                font-size: 0.85rem;
            }
            
            .section-title {
                flex-direction: column;
                align-items: flex-start;
                gap: 14px;
            }
            
            .table-scroll-container {
                max-height: 500px;
            }
            
            .dashboard-grid {
                gap: 14px;
            }
            
            .total-card .value {
                font-size: 2rem;
            }
            
            .strain-card .value {
                font-size: 1.6rem;
            }
            
            /* å°å±è®¾å¤‡è§¦æ‘¸ä¼˜åŒ– */
            .btn, input, select, textarea {
                min-height: 44px;
                font-size: 16px;
            }
            
            .nav-btn {
                padding: 18px 10px;
                font-size: 0.9rem;
            }
            
            /* å°å±è®¾å¤‡æŒ‰é’®ç»„å‚ç›´æ’åˆ— */
            .section-title .btn-group {
                flex-direction: column;
                width: 100%;
            }
            
            .section-title .btn-group .btn {
                width: 100%;
                margin-bottom: 8px;
            }
            
            /* å°å±è®¾å¤‡æ¨¡æ€æ¡†ä¼˜åŒ– */
            .modal-content {
                width: 95%;
                padding: 18px;
            }
            
            /* å°å±è®¾å¤‡å‡ºåº“å•å…ƒä¼˜åŒ– */
            .outbound-unit .form-row {
                flex-direction: column;
            }
            
            /* å°å±è®¾å¤‡ç­›é€‰æ§ä»¶ä¼˜åŒ– */
            .filter-controls {
                flex-direction: column;
            }
            
            .filter-controls .form-group {
                min-width: 100%;
            }
        }
        
        /* è¶…å°å±è®¾å¤‡ä¼˜åŒ– */
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 18px 0;
                border-radius: 8px;
            }
            
            header h1 {
                font-size: 1.4rem;
            }
            
            .nav-btn {
                min-width: 50%;
                padding: 16px 5px;
                font-size: 0.8rem;
            }
            
            .section {
                padding: 16px;
                border-radius: 8px;
            }
            
            .section-title {
                font-size: 1.1rem;
            }
            
            .chart-box {
                padding: 14px;
            }
            
            .chart-box h3 {
                font-size: 1rem;
                margin-bottom: 14px;
            }
            
            /* è¶…å°å±è®¾å¤‡æŒ‰é’®ä¼˜åŒ– */
            .btn {
                padding: 12px 16px;
                font-size: 0.9rem;
            }
            
            /* è¶…å°å±è®¾å¤‡è¡¨å•å…ƒç´ ä¼˜åŒ– */
            .form-row {
                gap: 12px;
            }
            
            .form-group {
                flex: 1 1 100%;
            }
            
            /* è¶…å°å±è®¾å¤‡å¡ç‰‡ä¼˜åŒ– */
            .total-card .value {
                font-size: 1.8rem;
            }
            
            .strain-card .value {
                font-size: 1.4rem;
            }
            
            /* è¶…å°å±è®¾å¤‡è¡¨æ ¼å®¹å™¨ä¼˜åŒ– */
            .table-scroll-container,
            .outbound-table-scroll-container {
                max-height: 350px;
                font-size: 0.8rem;
            }
            
            th, td {
                padding: 8px 10px;
            }
        }
        
        /* æ¨ªå±ä¸”å°å±è®¾å¤‡ä¼˜åŒ– */
        @media (orientation: landscape) and (max-height: 500px) {
            .container {
                padding: 10px;
            }
            
            header {
                padding: 15px 0;
                margin-bottom: 15px;
            }
            
            .section {
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .table-scroll-container,
            .outbound-table-scroll-container {
                max-height: 250px;
            }
            
            /* æ¨ªå±å°é«˜åº¦è®¾å¤‡å›¾è¡¨ä¼˜åŒ– */
            .chart-container {
                gap: 15px;
            }
            
            .chart-box {
                padding: 12px;
            }
            
            .chart-box h3 {
                margin-bottom: 10px;
                font-size: 0.95rem;
            }
        }
        
        /* é«˜åˆ†è¾¨ç‡è®¾å¤‡ä¼˜åŒ– */
        @media (min-width: 1400px) {
            .container {
                max-width: 1600px;
            }
            
            .chart-container {
                grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¥š è›‹åº“ç®¡ç†ç³»ç»Ÿ</h1>
            <p>ç§è›‹å…¥åº“ã€å‡ºåº“ã€åº“å­˜ç®¡ç†ä¸å¯è§†åŒ–åˆ†æ</p>
        </header>
        
        <nav>
            <button class="nav-btn active" data-target="dashboard">å¯è§†åŒ–çœ‹æ¿</button>
            <button class="nav-btn" data-target="inbound">ç§è›‹å…¥åº“</button>
            <button class="nav-btn" data-target="outbound">ç§è›‹å‡ºåº“</button>
            <button class="nav-btn" data-target="inventory">åº“å­˜ä¿¡æ¯</button>
            <button class="nav-btn" data-target="outbound-records">å‡ºåº“ä¿¡æ¯æŸ¥è¯¢</button>
        </nav>
        
        <!-- å¯è§†åŒ–çœ‹æ¿ -->
        <section id="dashboard" class="section active">
            <h2 class="section-title">å¯è§†åŒ–çœ‹æ¿</h2>
            
            <!-- ä¼˜åŒ–åçš„å¡ç‰‡å¸ƒå±€ -->
            <div class="dashboard-grid">
                <!-- æ€»åº“å­˜å¡ç‰‡æ”¾åœ¨æœ€å·¦è¾¹ -->
                <div class="stat-card total-card">
                    <h3>æ€»åº“å­˜é‡</h3>
                    <div class="value" id="totalInventory">0</div>
                    <p class="subtitle">ä¸ªç§è›‹</p>
                </div>
                
                <!-- å“ç³»å¡ç‰‡åœ¨åŒä¸€è¡Œ -->
                <div class="strain-card hailan-brown">
                    <h3>æµ·å…°è¤åº“å­˜</h3>
                    <div class="value" id="hailanBrownCount">0</div>
                    <p class="subtitle">ä¸ªç§è›‹</p>
                </div>
                
                <div class="strain-card hailan-white">
                    <h3>æµ·å…°ç™½åº“å­˜</h3>
                    <div class="value" id="hailanWhiteCount">0</div>
                    <p class="subtitle">ä¸ªç§è›‹</p>
                </div>
                
                <div class="strain-card hailan-pink">
                    <h3>æµ·å…°ç²‰åº“å­˜</h3>
                    <div class="value" id="hailanPinkCount">0</div>
                    <p class="subtitle">ä¸ªç§è›‹</p>
                </div>
                
                <div class="strain-card hailan-gray">
                    <h3>æµ·å…°ç°åº“å­˜</h3>
                    <div class="value" id="hailanGrayCount">0</div>
                    <p class="subtitle">ä¸ªç§è›‹</p>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-box">
                    <h3>å„å“ç³»ç§è›‹åº“å­˜é‡</h3>
                    <canvas id="strainChart"></canvas>
                </div>
                <div class="chart-box">
                    <h3>å„åˆ†å‚ç§è›‹åº“å­˜é‡</h3>
                    <canvas id="factoryChart"></canvas>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-box">
                    <h3>èƒšèƒæ¿€æ´»æ¬¡æ•°åˆ†å¸ƒ</h3>
                    <canvas id="activationChart"></canvas>
                </div>
                <div class="chart-box">
                    <h3>è¿‘7å¤©å…¥åº“/å‡ºåº“è¶‹åŠ¿</h3>
                    <canvas id="trendChart"></canvas>
                </div>
            </div>
        </section>
        
        <!-- ç§è›‹å…¥åº“ -->
        <section id="inbound" class="section">
            <h2 class="section-title">ç§è›‹å…¥åº“</h2>
            
            <div class="password-group">
                <h3>æ“ä½œéªŒè¯</h3>
                <p>å…¥åº“æ“ä½œéœ€è¦å¯†ç éªŒè¯ï¼Œè¯·è¾“å…¥å¯†ç ï¼š</p>
                <div class="form-group">
                    <label for="inbound-password">å¯†ç </label>
                    <input type="password" id="inbound-password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆé»˜è®¤å¯†ç ï¼š0ï¼‰">
                </div>
            </div>
            
            <div id="inbound-message" class="message"></div>
            
            <div class="batch-id-display">
                <div class="label">ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆæ‰¹æ¬¡å·</div>
                <div class="value" id="generated-batch-id">20241231-001</div>
                <div class="hint">æ ¼å¼ï¼šYYYYMMDD-ä¸‰ä½éšæœºç </div>
            </div>
            
            <h3>å…¥åº“ä¿¡æ¯å¡«å†™</h3>
            <div class="form-row">
                <div class="form-group">
                    <label for="batch-id">ç§è›‹æ‰¹æ¬¡å· *</label>
                    <input type="text" id="batch-id" placeholder="ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ" readonly>
                </div>
                <div class="form-group">
                    <label for="strain">å“ç³» *</label>
                    <select id="strain">
                        <option value="">è¯·é€‰æ‹©å“ç³»</option>
                        <option value="æµ·å…°è¤">æµ·å…°è¤</option>
                        <option value="æµ·å…°ç²‰">æµ·å…°ç²‰</option>
                        <option value="æµ·å…°ç°">æµ·å…°ç°</option>
                        <option value="æµ·å…°ç™½">æµ·å…°ç™½</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="factory">åˆ†å‚ *</label>
                    <input type="text" id="factory" placeholder="ä¾‹å¦‚ï¼šé’å››">
                </div>
                <div class="form-group">
                    <label for="building">æ ‹èˆ</label>
                    <input type="text" id="building" placeholder="ä¾‹å¦‚ï¼š1å·æ ‹èˆ">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="week-age">å‘¨é¾„</label>
                    <input type="number" id="week-age" placeholder="ä¾‹å¦‚ï¼š25">
                </div>
                <div class="form-group">
                    <label for="egg-count">ç§è›‹æ•°é‡ *</label>
                    <input type="number" id="egg-count" placeholder="ä¾‹å¦‚ï¼š7560" value="7560">
                </div>
                <div class="form-group">
                    <label for="select-range">é€‰è›‹èŒƒå›´</label>
                    <input type="text" id="select-range" placeholder="ä¾‹å¦‚ï¼š45-65g">
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="start-lay-time">èµ·å§‹äº§è›‹æ—¥æœŸ *</label>
                    <input type="date" id="start-lay-time" required>
                </div>
                <div class="form-group">
                    <label for="end-lay-time">ç»“æŸäº§è›‹æ—¥æœŸ</label>
                    <input type="date" id="end-lay-time">
                </div>
                <div class="form-group">
                    <label for="receive-time">æ¥æ”¶æ—¥æœŸ *</label>
                    <input type="date" id="receive-time" required>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="select-time">é€‰è›‹æ—¥æœŸ</label>
                    <input type="date" id="select-time">
                </div>
                <div class="form-group">
                    <label for="embryo-activation">èƒšèƒæ¿€æ´»æ¬¡æ•° *</label>
                    <select id="embryo-activation" required>
                        <option value="0" selected>0æ¬¡ (0-7å¤©)</option>
                        <option value="1">1æ¬¡ (8-11å¤©)</option>
                        <option value="2">2æ¬¡ (12-14å¤©)</option>
                        <option value="3">3æ¬¡ (15-21å¤©)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="remarks">å¤‡æ³¨</label>
                    <textarea id="remarks" rows="3" placeholder="å¯å¡«å†™å…¥åº“ç›¸å…³å¤‡æ³¨ä¿¡æ¯"></textarea>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <button class="btn btn-success" id="inbound-submit">æäº¤å…¥åº“</button>
                    <button class="btn btn-secondary" id="inbound-reset">é‡ç½®è¡¨å•</button>
                    <button class="btn" id="regenerate-batch-id">é‡æ–°ç”Ÿæˆæ‰¹æ¬¡å·</button>
                </div>
            </div>
        </section>
        
        <!-- ç§è›‹å‡ºåº“ -->
        <section id="outbound" class="section">
            <h2 class="section-title">ç§è›‹å‡ºåº“</h2>
            
            <div class="password-group">
                <h3>æ“ä½œéªŒè¯</h3>
                <p>å‡ºåº“æ“ä½œéœ€è¦å¯†ç éªŒè¯ï¼Œè¯·è¾“å…¥å¯†ç ï¼š</p>
                <div class="form-group">
                    <label for="outbound-password">å¯†ç </label>
                    <input type="password" id="outbound-password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆé»˜è®¤å¯†ç ï¼š0ï¼‰">
                </div>
            </div>
            
            <div id="outbound-message" class="message"></div>
            
            <h3>å‡ºåº“ä¿¡æ¯å¡«å†™</h3>
            <div class="outbound-unit">
                <h4><span class="unit-number">1</span> å‡ºåº“æ‰¹æ¬¡ 1</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="outbound-batch-id-1">ç§è›‹æ‰¹æ¬¡å·</label>
                        <input type="text" id="outbound-batch-id-1" placeholder="è¾“å…¥è¦å‡ºåº“çš„æ‰¹æ¬¡å·" class="batch-input">
                    </div>
                    <div class="form-group">
                        <label for="outbound-egg-count-1">å‡ºåº“æ•°é‡</label>
                        <input type="number" id="outbound-egg-count-1" placeholder="è¾“å…¥å‡ºåº“æ•°é‡" class="count-input">
                    </div>
                    <div class="form-group">
                        <label for="incubator-number-1">å­µåŒ–æœºå·</label>
                        <input type="text" id="incubator-number-1" placeholder="è¾“å…¥å­µåŒ–æœºå·" class="incubator-input">
                    </div>
                </div>
            </div>
            
            <div class="outbound-unit">
                <h4><span class="unit-number">2</span> å‡ºåº“æ‰¹æ¬¡ 2</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="outbound-batch-id-2">ç§è›‹æ‰¹æ¬¡å·</label>
                        <input type="text" id="outbound-batch-id-2" placeholder="è¾“å…¥è¦å‡ºåº“çš„æ‰¹æ¬¡å·" class="batch-input">
                    </div>
                    <div class="form-group">
                        <label for="outbound-egg-count-2">å‡ºåº“æ•°é‡</label>
                        <input type="number" id="outbound-egg-count-2" placeholder="è¾“å…¥å‡ºåº“æ•°é‡" class="count-input">
                    </div>
                    <div class="form-group">
                        <label for="incubator-number-2">å­µåŒ–æœºå·</label>
                        <input type="text" id="incubator-number-2" placeholder="è¾“å…¥å­µåŒ–æœºå·" class="incubator-input">
                    </div>
                </div>
            </div>
            
            <div class="outbound-unit">
                <h4><span class="unit-number">3</span> å‡ºåº“æ‰¹æ¬¡ 3</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="outbound-batch-id-3">ç§è›‹æ‰¹æ¬¡å·</label>
                        <input type="text" id="outbound-batch-id-3" placeholder="è¾“å…¥è¦å‡ºåº“çš„æ‰¹æ¬¡å·" class="batch-input">
                    </div>
                    <div class="form-group">
                        <label for="outbound-egg-count-3">å‡ºåº“æ•°é‡</label>
                        <input type="number" id="outbound-egg-count-3" placeholder="è¾“å…¥å‡ºåº“æ•°é‡" class="count-input">
                    </div>
                    <div class="form-group">
                        <label for="incubator-number-3">å­µåŒ–æœºå·</label>
                        <input type="text" id="incubator-number-3" placeholder="è¾“å…¥å­µåŒ–æœºå·" class="incubator-input">
                    </div>
                </div>
            </div>
            
            <div class="outbound-unit">
                <h4><span class="unit-number">4</span> å‡ºåº“æ‰¹æ¬¡ 4</h4>
                <div class="form-row">
                    <div class="form-group">
                        <label for="outbound-batch-id-4">ç§è›‹æ‰¹æ¬¡å·</label>
                        <input type="text" id="outbound-batch-id-4" placeholder="è¾“å…¥è¦å‡ºåº“çš„æ‰¹æ¬¡å·" class="batch-input">
                    </div>
                    <div class="form-group">
                        <label for="outbound-egg-count-4">å‡ºåº“æ•°é‡</label>
                        <input type="number" id="outbound-egg-count-4" placeholder="è¾“å…¥å‡ºåº“æ•°é‡" class="count-input">
                    </div>
                    <div class="form-group">
                        <label for="incubator-number-4">å­µåŒ–æœºå·</label>
                        <input type="text" id="incubator-number-4" placeholder="è¾“å…¥å­µåŒ–æœºå·" class="incubator-input">
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <button class="btn btn-danger" id="outbound-submit">æ‰¹é‡æäº¤å‡ºåº“</button>
                    <button class="btn btn-secondary" id="clear-outbound-fields">æ¸…ç©ºæ‰€æœ‰å‡ºåº“å­—æ®µ</button>
                </div>
            </div>
            
            <div class="search-box">
                <h3>åº“å­˜æ‰¹æ¬¡æŸ¥è¯¢</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="search-batch">æŒ‰æ‰¹æ¬¡å·æŸ¥è¯¢</label>
                        <input type="text" id="search-batch" placeholder="è¾“å…¥æ‰¹æ¬¡å·æŸ¥è¯¢åº“å­˜ä¿¡æ¯">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn" id="search-btn">æŸ¥è¯¢</button>
                        <button class="btn" id="reset-search">é‡ç½®æŸ¥è¯¢</button>
                    </div>
                </div>
                
                <div id="search-result">
                    <!-- æŸ¥è¯¢ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </section>
        
        <!-- åº“å­˜ä¿¡æ¯ -->
        <section id="inventory" class="section">
            <h2 class="section-title">
                åº“å­˜ä¿¡æ¯
                <div class="btn-group">
                    <button class="btn btn-warning" id="export-inventory-btn">å¯¼å‡ºåº“å­˜æ•°æ®</button>
                    <button class="btn btn-secondary" id="refresh-inventory-btn">åˆ·æ–°æ•°æ®</button>
                    <button class="btn btn-danger" id="delete-selected-inventory-btn">åˆ é™¤é€‰ä¸­è®°å½•</button>
                </div>
            </h2>
            
            <div class="search-box">
                <h3>åº“å­˜ç­›é€‰</h3>
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="inventory-search-date">æŒ‰é€‰è›‹æ—¥æœŸç­›é€‰</label>
                        <input type="date" id="inventory-search-date">
                    </div>
                    <div class="form-group">
                        <label for="inventory-search-strain">æŒ‰å“ç³»ç­›é€‰</label>
                        <select id="inventory-search-strain">
                            <option value="">å…¨éƒ¨å“ç³»</option>
                            <option value="æµ·å…°è¤">æµ·å…°è¤</option>
                            <option value="æµ·å…°ç²‰">æµ·å…°ç²‰</option>
                            <option value="æµ·å…°ç°">æµ·å…°ç°</option>
                            <option value="æµ·å…°ç™½">æµ·å…°ç™½</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inventory-search-factory">æŒ‰åˆ†å‚ç­›é€‰</label>
                        <select id="inventory-search-factory">
                            <option value="">å…¨éƒ¨åˆ†å‚</option>
                            <!-- åˆ†å‚é€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inventory-search-activation">æŒ‰èƒšèƒæ¿€æ´»æ¬¡æ•°ç­›é€‰</label>
                        <select id="inventory-search-activation">
                            <option value="">å…¨éƒ¨</option>
                            <option value="0">0æ¬¡ (0-7å¤©)</option>
                            <option value="1">1æ¬¡ (8-11å¤©)</option>
                            <option value="2">2æ¬¡ (12-14å¤©)</option>
                            <option value="3">3æ¬¡ (15-21å¤©)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inventory-search-select-range">æŒ‰é€‰è›‹èŒƒå›´ç­›é€‰</label>
                        <select id="inventory-search-select-range">
                            <option value="">å…¨éƒ¨é€‰è›‹èŒƒå›´</option>
                            <!-- é€‰è›‹èŒƒå›´é€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inventory-search-storage-days">æŒ‰å­˜è›‹å¤©æ•°ç­›é€‰</label>
                        <input type="number" id="inventory-search-storage-days" placeholder="è¾“å…¥å®é™…å¤©æ•°ï¼Œå¦‚ï¼š7">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn" id="inventory-search-btn">ç­›é€‰</button>
                        <button class="btn" id="inventory-reset-search">é‡ç½®ç­›é€‰</button>
                    </div>
                </div>
            </div>
            
            <div id="inventory-result">
                <!-- åº“å­˜ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
            
            <!-- æ–°å¢ï¼šæ•°æ®å¤‡ä»½æ¢å¤åŒºåŸŸ -->
            <div class="backup-section">
                <h3>æ•°æ®å¤‡ä»½ä¸æ¢å¤</h3>
                <div class="backup-buttons">
                    <button class="btn btn-success" id="backup-data-btn">å¤‡ä»½å½“å‰æ•°æ®</button>
                    <button class="btn btn-warning" id="restore-data-btn">ä»å¤‡ä»½æ¢å¤</button>
                    <button class="btn btn-secondary" id="export-json-btn">å¯¼å‡ºä¸ºJSONæ–‡ä»¶</button>
                    <!-- ä¿®æ”¹ï¼šä½¿ç”¨æ–‡ä»¶åŒ…è£…å™¨è®©æŒ‰é’®çœ‹èµ·æ¥åƒæŒ‰é’®ï¼Œä½†å®é™…ä¸Šæ˜¯ä¸€ä¸ªæ–‡ä»¶è¾“å…¥ -->
                    <div class="file-input-wrapper">
                        <button class="btn btn-secondary" id="import-json-btn">ä»JSONæ–‡ä»¶å¯¼å…¥</button>
                        <input type="file" id="import-json-file" accept=".json" style="display: none;">
                    </div>
                </div>
                <p style="margin-top: 10px; color: #666; font-size: 0.85rem;">
                    æç¤ºï¼šå¤‡ä»½æ•°æ®å°†ä¿å­˜åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ï¼Œæ¢å¤æ•°æ®ä¼šè¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼Œè¯·è°¨æ…æ“ä½œï¼
                </p>
            </div>
        </section>
        
        <!-- å‡ºåº“ä¿¡æ¯æŸ¥è¯¢ -->
        <section id="outbound-records" class="section">
            <h2 class="section-title">
                å‡ºåº“ä¿¡æ¯æŸ¥è¯¢
                <div class="btn-group">
                    <button class="btn btn-warning" id="export-outbound-btn">å¯¼å‡ºå‡ºåº“è®°å½•</button>
                    <button class="btn btn-success" id="show-reimport-modal">é‡æ–°å…¥åº“</button>
                    <button class="btn btn-danger" id="delete-selected-outbound-btn">åˆ é™¤é€‰ä¸­è®°å½•</button>
                </div>
            </h2>
            
            <div id="reimport-modal" class="modal-overlay">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>é‡æ–°å…¥åº“</h3>
                        <button class="modal-close" id="close-reimport-modal">&times;</button>
                    </div>
                    <div class="password-group">
                        <h4>æ“ä½œéªŒè¯</h4>
                        <p>é‡æ–°å…¥åº“æ“ä½œéœ€è¦å¯†ç éªŒè¯ï¼Œè¯·è¾“å…¥å¯†ç ï¼š</p>
                        <div class="form-group">
                            <label for="reimport-password">å¯†ç </label>
                            <input type="password" id="reimport-password" placeholder="è¯·è¾“å…¥å¯†ç ï¼ˆé»˜è®¤å¯†ç ï¼š0ï¼‰">
                        </div>
                    </div>
                    
                    <div id="reimport-message" class="message"></div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reimport-batch-id">å‡ºåº“æ‰¹æ¬¡å· *</label>
                            <input type="text" id="reimport-batch-id" placeholder="è¾“å…¥è¦é‡æ–°å…¥åº“çš„æ‰¹æ¬¡å·">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reimport-egg-count">é‡æ–°å…¥åº“æ•°é‡ *</label>
                            <input type="number" id="reimport-egg-count" placeholder="è¾“å…¥é‡æ–°å…¥åº“æ•°é‡">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reimport-embryo-activation">é‡æ–°é€‰æ‹©èƒšèƒæ¿€æ´»æ¬¡æ•° *</label>
                            <select id="reimport-embryo-activation" required>
                                <option value="">è¯·é€‰æ‹©èƒšèƒæ¿€æ´»æ¬¡æ•°</option>
                                <option value="0">0æ¬¡ (0-7å¤©)</option>
                                <option value="1">1æ¬¡ (8-11å¤©)</option>
                                <option value="2">2æ¬¡ (12-14å¤©)</option>
                                <option value="3">3æ¬¡ (15-21å¤©)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="reimport-remarks">é‡æ–°å…¥åº“å¤‡æ³¨</label>
                            <textarea id="reimport-remarks" rows="3" placeholder="å¡«å†™é‡æ–°å…¥åº“åŸå› ç­‰ä¿¡æ¯"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <button class="btn btn-success" id="reimport-submit">æäº¤é‡æ–°å…¥åº“</button>
                            <button class="btn btn-secondary" id="cancel-reimport">å–æ¶ˆ</button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="search-box">
                <h3>å‡ºåº“è®°å½•ç­›é€‰</h3>
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="outbound-search-batch">æŒ‰æ‰¹æ¬¡å·æŸ¥è¯¢</label>
                        <input type="text" id="outbound-search-batch" placeholder="è¾“å…¥æ‰¹æ¬¡å·æŸ¥è¯¢å‡ºåº“è®°å½•">
                    </div>
                    <div class="form-group">
                        <label for="outbound-search-strain">æŒ‰å“ç³»æŸ¥è¯¢</label>
                        <select id="outbound-search-strain">
                            <option value="">å…¨éƒ¨å“ç³»</option>
                            <option value="æµ·å…°è¤">æµ·å…°è¤</option>
                            <option value="æµ·å…°ç²‰">æµ·å…°ç²‰</option>
                            <option value="æµ·å…°ç°">æµ·å…°ç°</option>
                            <option value="æµ·å…°ç™½">æµ·å…°ç™½</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="outbound-search-factory">æŒ‰åˆ†å‚æŸ¥è¯¢</label>
                        <select id="outbound-search-factory">
                            <option value="">å…¨éƒ¨åˆ†å‚</option>
                            <!-- åˆ†å‚é€‰é¡¹å°†åŠ¨æ€ç”Ÿæˆ -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="outbound-search-activation">æŒ‰èƒšèƒæ¿€æ´»æ¬¡æ•°æŸ¥è¯¢</label>
                        <select id="outbound-search-activation">
                            <option value="">å…¨éƒ¨</option>
                            <option value="0">0æ¬¡ (0-7å¤©)</option>
                            <option value="1">1æ¬¡ (8-11å¤©)</option>
                            <option value="2">2æ¬¡ (12-14å¤©)</option>
                            <option value="3">3æ¬¡ (15-21å¤©)</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn" id="outbound-search-btn">æŸ¥è¯¢</button>
                        <button class="btn" id="outbound-reset-search">é‡ç½®æŸ¥è¯¢</button>
                    </div>
                </div>
            </div>
            
            <div id="outbound-records-result">
                <!-- å‡ºåº“è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </section>
        
        <!-- æ–°å¢ï¼šç¼–è¾‘åº“å­˜ä¿¡æ¯æ¨¡æ€æ¡† -->
        <div id="edit-inventory-modal" class="modal-overlay">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>ä¿®æ”¹åº“å­˜ä¿¡æ¯</h3>
                    <button class="modal-close" id="close-edit-modal">&times;</button>
                </div>
                
                <div class="edit-batch-display">
                    <div class="label">æ‰¹æ¬¡å·ï¼ˆä¸å¯ä¿®æ”¹ï¼‰</div>
                    <div class="value" id="edit-batch-id-display">20241231-001</div>
                </div>
                
                <div id="edit-message" class="message"></div>
                
                <div class="edit-form-row">
                    <div class="edit-form-group">
                        <label for="edit-strain">å“ç³» *</label>
                        <select id="edit-strain">
                            <option value="">è¯·é€‰æ‹©å“ç³»</option>
                            <option value="æµ·å…°è¤">æµ·å…°è¤</option>
                            <option value="æµ·å…°ç²‰">æµ·å…°ç²‰</option>
                            <option value="æµ·å…°ç°">æµ·å…°ç°</option>
                            <option value="æµ·å…°ç™½">æµ·å…°ç™½</option>
                        </select>
                    </div>
                    <div class="edit-form-group">
                        <label for="edit-factory">åˆ†å‚ *</label>
                        <input type="text" id="edit-factory" placeholder="ä¾‹å¦‚ï¼šé’å››">
                    </div>
                    <div class="edit-form-group">
                        <label for="edit-building">æ ‹èˆ</label>
                        <input type="text" id="edit-building" placeholder="ä¾‹å¦‚ï¼š1å·æ ‹èˆ">
                    </div>
                </div>
                
                <div class="edit-form-row">
                    <div class="edit-form-group">
                        <label for="edit-week-age">å‘¨é¾„</label>
                        <input type="number" id="edit-week-age" placeholder="ä¾‹å¦‚ï¼š25">
                    </div>
                    <div class="edit-form-group">
                        <label for="edit-egg-count">ç§è›‹æ•°é‡ *</label>
                        <input type="number" id="edit-egg-count" placeholder="ä¾‹å¦‚ï¼š1000">
                    </div>
                    <div class="edit-form-group">
                        <label for="edit-select-range">é€‰è›‹èŒƒå›´</label>
                        <input type="text" id="edit-select-range" placeholder="ä¾‹å¦‚ï¼š45-65g">
                    </div>
                </div>
                
                <div class="edit-form-row">
                    <div class="edit-form-group">
                        <label for="edit-start-lay-time">èµ·å§‹äº§è›‹æ—¥æœŸ *</label>
                        <input type="date" id="edit-start-lay-time" required>
                    </div>
                    <div class="edit-form-group">
                        <label for="edit-end-lay-time">ç»“æŸäº§è›‹æ—¥æœŸ</label>
                        <input type="date" id="edit-end-lay-time">
                    </div>
                    <div class="edit-form-group">
                        <label for="edit-receive-time">æ¥æ”¶æ—¥æœŸ *</label>
                        <input type="date" id="edit-receive-time" required>
                    </div>
                </div>
                
                <div class="edit-form-row">
                    <div class="edit-form-group">
                        <label for="edit-select-time">é€‰è›‹æ—¥æœŸ</label>
                        <input type="date" id="edit-select-time">
                    </div>
                    <div class="edit-form-group">
                        <label for="edit-embryo-activation">èƒšèƒæ¿€æ´»æ¬¡æ•° *</label>
                        <select id="edit-embryo-activation" required>
                            <option value="">è¯·é€‰æ‹©èƒšèƒæ¿€æ´»æ¬¡æ•°</option>
                            <option value="0">0æ¬¡ (0-7å¤©)</option>
                            <option value="1">1æ¬¡ (8-11å¤©)</option>
                            <option value="2">2æ¬¡ (12-14å¤©)</option>
                            <option value="3">3æ¬¡ (15-21å¤©)</option>
                        </select>
                    </div>
                    <div class="edit-form-group">
                        <label for="edit-remarks">å¤‡æ³¨</label>
                        <textarea id="edit-remarks" rows="3" placeholder="å¯å¡«å†™å¤‡æ³¨ä¿¡æ¯"></textarea>
                    </div>
                </div>
                
                <div class="edit-form-row">
                    <div class="edit-form-group">
                        <button class="btn btn-success" id="edit-submit">ä¿å­˜ä¿®æ”¹</button>
                        <button class="btn btn-secondary" id="cancel-edit">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="clear-data-btn">
            <button class="btn btn-danger" id="clear-data-btn">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>
            <button class="btn btn-success" id="load-example-data-btn">åŠ è½½ç¤ºä¾‹æ•°æ®</button>
        </div>
        
        <footer>
            <p>è›‹åº“ç®¡ç†ç³»ç»Ÿ &copy; 2023 | è®¾è®¡ç”¨äºç§è›‹æ‰¹æ¬¡ç®¡ç†</p>
            <p>é»˜è®¤å…¥åº“/å‡ºåº“/é‡æ–°å…¥åº“å¯†ç ï¼š0 | æ¸…ç©ºæ•°æ®å¯†ç ï¼š0000 | æ•°æ®å¤‡ä»½åŠŸèƒ½å·²å¯ç”¨</p>
        </footer>
    </div>

    <script>
        // æ•°æ®å­˜å‚¨å’Œåˆå§‹åŒ–
        let eggInventory = [];
        let outboundRecords = [];
        let currentEditIndex = -1; // å½“å‰æ­£åœ¨ç¼–è¾‘çš„åº“å­˜ç´¢å¼•
        
        // 1. å†…ç½®æ•°æ® - è¿™äº›æ•°æ®å°†ç›´æ¥å­˜å‚¨åœ¨ä»£ç ä¸­
        const builtInData = {
            eggInventory: [
                {
                    batchId: "20241215-123",
                    strain: "æµ·å…°è¤",
                    factory: "é’å››",
                    building: "1å·æ ‹èˆ",
                    weekAge: "28",
                    eggCount: 1200,
                    selectRange: "45-65g",
                    startLayTime: "2024-01-01",
                    endLayTime: "2024-01-05",
                    receiveTime: "2024-01-06",
                    selectTime: "2024-01-06",
                    embryoActivation: 0,
                    remarks: "ç¬¬ä¸€æ‰¹ä¼˜è´¨ç§è›‹",
                    storageDays: 14,
                    inboundDate: "2024-01-06"
                },
                {
                    batchId: "20241216-234",
                    strain: "æµ·å…°ç²‰",
                    factory: "é’ä¸‰",
                    building: "2å·æ ‹èˆ",
                    weekAge: "32",
                    eggCount: 1500,
                    selectRange: "50-70g",
                    startLayTime: "2024-01-05",
                    endLayTime: "2024-01-10",
                    receiveTime: "2024-01-11",
                    selectTime: "2024-01-11",
                    embryoActivation: 1,
                    remarks: "ç²‰è‰²å“ç³»ä¼˜è´¨è›‹",
                    storageDays: 10,
                    inboundDate: "2024-01-11"
                },
                {
                    batchId: "20241217-345",
                    strain: "æµ·å…°ç°",
                    factory: "é’äºŒ",
                    building: "3å·æ ‹èˆ",
                    weekAge: "30",
                    eggCount: 900,
                    selectRange: "48-68g",
                    startLayTime: "2024-01-08",
                    endLayTime: "2024-01-13",
                    receiveTime: "2024-01-14",
                    selectTime: "2024-01-14",
                    embryoActivation: 2,
                    remarks: "ç°è‰²å“ç³»ï¼Œä¸­ç­‰å¤§å°",
                    storageDays: 7,
                    inboundDate: "2024-01-14"
                },
                {
                    batchId: "20241218-456",
                    strain: "æµ·å…°ç™½",
                    factory: "é’å››",
                    building: "4å·æ ‹èˆ",
                    weekAge: "26",
                    eggCount: 1100,
                    selectRange: "46-66g",
                    startLayTime: "2024-01-10",
                    endLayTime: "2024-01-15",
                    receiveTime: "2024-01-16",
                    selectTime: "2024-01-16",
                    embryoActivation: 3,
                    remarks: "ç™½è‰²å“ç³»ï¼Œé€‚åˆå­µåŒ–",
                    storageDays: 5,
                    inboundDate: "2024-01-16"
                }
            ],
            outboundRecords: [
                {
                    batchId: "20241210-789",
                    strain: "æµ·å…°è¤",
                    factory: "é’å››",
                    building: "1å·æ ‹èˆ",
                    weekAge: "30",
                    eggCount: 800,
                    selectRange: "45-65g",
                    startLayTime: "2023-12-01",
                    endLayTime: "2023-12-05",
                    receiveTime: "2023-12-06",
                    selectTime: "2023-12-06",
                    embryoActivation: 0,
                    remarks: "å·²å‡ºåº“",
                    storageDays: 45,
                    inboundDate: "2023-12-06",
                    outboundCount: 500,
                    incubatorNumber: "å­µåŒ–æœº01",
                    outboundDate: "2024-01-10",
                    originalCount: 800,
                    remainingCount: 300
                }
            ]
        };
        
        // é¡µé¢åŠ è½½æ—¶ä»æœ¬åœ°å­˜å‚¨æ¢å¤æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨å†…ç½®æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            const savedInventory = localStorage.getItem('eggInventoryData');
            const savedOutboundRecords = localStorage.getItem('outboundRecordsData');
            
            // æ£€æŸ¥æ˜¯å¦æœ‰å¤‡ä»½æ•°æ®
            const backupData = localStorage.getItem('eggSystemBackup');
            
            if (savedInventory) {
                try {
                    eggInventory = JSON.parse(savedInventory);
                } catch (e) {
                    console.error('è§£æåº“å­˜æ•°æ®å¤±è´¥:', e);
                    eggInventory = [...builtInData.eggInventory];
                }
            } else if (backupData) {
                try {
                    // å¦‚æœæœ‰å¤‡ä»½æ•°æ®ï¼Œä½¿ç”¨å¤‡ä»½æ•°æ®
                    const backup = JSON.parse(backupData);
                    eggInventory = backup.eggInventory || [];
                    outboundRecords = backup.outboundRecords || [];
                } catch (e) {
                    console.error('è§£æå¤‡ä»½æ•°æ®å¤±è´¥:', e);
                    eggInventory = [...builtInData.eggInventory];
                }
            } else {
                // æ—¢æ²¡æœ‰æœ¬åœ°æ•°æ®ä¹Ÿæ²¡æœ‰å¤‡ä»½ï¼Œä½¿ç”¨å†…ç½®æ•°æ®
                eggInventory = [...builtInData.eggInventory];
                outboundRecords = [...builtInData.outboundRecords];
            }
            
            // å‡ºåº“è®°å½•å•ç‹¬å¤„ç†
            if (savedOutboundRecords) {
                try {
                    outboundRecords = JSON.parse(savedOutboundRecords);
                } catch (e) {
                    console.error('è§£æå‡ºåº“è®°å½•å¤±è´¥:', e);
                    outboundRecords = [...builtInData.outboundRecords];
                }
            } else if (!backupData) {
                // å¦‚æœæ²¡æœ‰æœ¬åœ°å­˜å‚¨çš„å‡ºåº“è®°å½•ï¼Œä½¿ç”¨å†…ç½®çš„å‡ºåº“è®°å½•
                outboundRecords = [...builtInData.outboundRecords];
            }
            
            // åˆå§‹åŒ–é¡µé¢
            initNavigation();
            initInboundForm();
            initOutboundForm();
            initSearch();
            initClearData();
            initExportButtons();
            initOutboundRecords();
            initReimportModal();
            initEditModal();
            initBackupFunctions(); // åˆå§‹åŒ–å¤‡ä»½åŠŸèƒ½
            updateDashboard();
            displayInventory();
            
            // è®¾ç½®é€‰è›‹æ—¥æœŸä¸ºå½“å‰æ—¥æœŸï¼Œæ¥æ”¶æ—¥æœŸä¸ºç©º
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('select-time').value = today;
            document.getElementById('receive-time').value = '';
            
            // ç”Ÿæˆåˆå§‹æ‰¹æ¬¡å·
            generateBatchId();
            
            // æ›´æ–°æ‰¹æ¬¡å·æ˜¾ç¤º
            document.getElementById('batch-id').value = document.getElementById('generated-batch-id').textContent;
            
            // è®¾ç½®èµ·å§‹äº§è›‹æ—¥æœŸä¸º7å¤©å‰
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            document.getElementById('start-lay-time').value = sevenDaysAgo.toISOString().split('T')[0];
            
            // ä¸ºå‡ºåº“å­—æ®µæ·»åŠ è¾“å…¥ç›‘å¬ï¼Œå®ç°æ™ºèƒ½éªŒè¯
            initOutboundFieldValidation();
            
            // åˆå§‹åŒ–åˆ é™¤é€‰ä¸­è®°å½•åŠŸèƒ½
            initDeleteSelectedRecords();
            
            // åˆå§‹åŒ–åŠ è½½ç¤ºä¾‹æ•°æ®æŒ‰é’®
            initExampleDataButton();
            
            // åˆå§‹åŒ–ç­›é€‰ä¸‹æ‹‰é€‰é¡¹
            updateFilterOptions();
        });
        
        // ç”Ÿæˆæ‰¹æ¬¡å·å‡½æ•° - ä¿®æ”¹ä¸ºYYYYMMDD-ä¸‰ä½éšæœºç 
        function generateBatchId() {
            const now = new Date();
            const year = now.getFullYear().toString();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            const randomCode = Math.floor(100 + Math.random() * 900).toString();
            
            const batchId = `${year}${month}${day}-${randomCode}`;
            document.getElementById('generated-batch-id').textContent = batchId;
            document.getElementById('batch-id').value = batchId;
        }
        
        // è®¡ç®—å­˜è›‹å¤©æ•°ï¼ˆèµ·å§‹äº§è›‹æ—¥æœŸåˆ°å½“å¤©çš„å¤©æ•°å·®ï¼‰
        function calculateStorageDays(startLayTime) {
            if (!startLayTime || startLayTime === 'æœªå¡«å†™') {
                return 'æœªçŸ¥';
            }
            
            try {
                const startDate = new Date(startLayTime);
                const today = new Date();
                
                // ç¡®ä¿æ—¥æœŸæœ‰æ•ˆ
                if (isNaN(startDate.getTime())) {
                    return 'æ—¥æœŸæ ¼å¼é”™è¯¯';
                }
                
                // è®¡ç®—å¤©æ•°å·®
                const timeDiff = today.getTime() - startDate.getTime();
                const daysDiff = Math.floor(timeDiff / (1000 * 3600 * 24));
                
                return daysDiff;
            } catch (error) {
                console.error('è®¡ç®—å­˜è›‹å¤©æ•°æ—¶å‡ºé”™:', error);
                return 'è®¡ç®—é”™è¯¯';
            }
        }
        
        // æ ¹æ®å­˜è›‹å¤©æ•°è·å–æ ·å¼ç±»
        function getStorageDaysClass(storageDays) {
            if (typeof storageDays !== 'number' || isNaN(storageDays)) {
                return '';
            }
            
            if (storageDays <= 7) {
                return 'storage-time low';
            } else if (storageDays <= 14) {
                return 'storage-time medium';
            } else {
                return 'storage-time high';
            }
        }
        
        // å¯¼èˆªåˆ‡æ¢åŠŸèƒ½
        function initNavigation() {
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    
                    // ç§»é™¤æ‰€æœ‰activeç±»
                    navButtons.forEach(btn => btn.classList.remove('active'));
                    document.querySelectorAll('.section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // æ·»åŠ activeç±»åˆ°å½“å‰æŒ‰é’®å’Œç›®æ ‡éƒ¨åˆ†
                    this.classList.add('active');
                    document.getElementById(targetId).classList.add('active');
                    
                    // å¦‚æœæ˜¯çœ‹æ¿ï¼Œæ›´æ–°å›¾è¡¨
                    if (targetId === 'dashboard') {
                        updateDashboard();
                    } else if (targetId === 'inventory') {
                        displayInventory();
                        // æ›´æ–°ç­›é€‰ä¸‹æ‹‰é€‰é¡¹
                        updateFilterOptions();
                    } else if (targetId === 'outbound-records') {
                        displayOutboundRecords();
                    }
                });
            });
        }
        
        // åˆå§‹åŒ–ç¼–è¾‘æ¨¡æ€æ¡†
        function initEditModal() {
            const editModal = document.getElementById('edit-inventory-modal');
            const closeEditModalBtn = document.getElementById('close-edit-modal');
            const cancelEditBtn = document.getElementById('cancel-edit');
            const editSubmitBtn = document.getElementById('edit-submit');
            const editMessage = document.getElementById('edit-message');
            
            // å…³é—­æ¨¡æ€æ¡†
            closeEditModalBtn.addEventListener('click', function() {
                editModal.classList.remove('active');
                resetEditForm();
            });
            
            cancelEditBtn.addEventListener('click', function() {
                editModal.classList.remove('active');
                resetEditForm();
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            editModal.addEventListener('click', function(e) {
                if (e.target === editModal) {
                    editModal.classList.remove('active');
                    resetEditForm();
                }
            });
            
            // æäº¤ç¼–è¾‘
            editSubmitBtn.addEventListener('click', function() {
                // éªŒè¯å¿…å¡«å­—æ®µ
                const strain = document.getElementById('edit-strain').value.trim();
                const factory = document.getElementById('edit-factory').value.trim();
                const eggCount = document.getElementById('edit-egg-count').value.trim();
                const startLayTime = document.getElementById('edit-start-lay-time').value;
                const receiveTime = document.getElementById('edit-receive-time').value;
                const embryoActivation = document.getElementById('edit-embryo-activation').value;
                
                if (!strain || !factory || !eggCount || !startLayTime || !receiveTime || embryoActivation === '') {
                    showMessage(editMessage, 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼', 'error');
                    return;
                }
                
                // æ›´æ–°åº“å­˜æ•°æ®
                const updatedItem = {
                    ...eggInventory[currentEditIndex],
                    strain: strain,
                    factory: factory,
                    building: document.getElementById('edit-building').value.trim() || 'æœªå¡«å†™',
                    weekAge: document.getElementById('edit-week-age').value.trim() || 'æœªå¡«å†™',
                    eggCount: parseInt(eggCount),
                    selectRange: document.getElementById('edit-select-range').value.trim() || 'æœªå¡«å†™',
                    startLayTime: startLayTime || 'æœªå¡«å†™',
                    endLayTime: document.getElementById('edit-end-lay-time').value || 'æœªå¡«å†™',
                    receiveTime: receiveTime || 'æœªå¡«å†™',
                    selectTime: document.getElementById('edit-select-time').value || 'æœªå¡«å†™',
                    embryoActivation: parseInt(embryoActivation),
                    remarks: document.getElementById('edit-remarks').value.trim() || 'æ— ',
                    storageDays: calculateStorageDays(startLayTime)
                };
                
                // æ›´æ–°åº“å­˜æ•°ç»„
                eggInventory[currentEditIndex] = updatedItem;
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveToLocalStorage();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showMessage(editMessage, `æ‰¹æ¬¡ ${updatedItem.batchId} ä¿¡æ¯å·²æ›´æ–°ï¼`, 'success');
                
                // é‡ç½®è¡¨å•å¹¶å…³é—­æ¨¡æ€æ¡†
                setTimeout(() => {
                    editModal.classList.remove('active');
                    resetEditForm();
                    
                    // æ›´æ–°çœ‹æ¿
                    updateDashboard();
                    
                    // æ›´æ–°åº“å­˜æ˜¾ç¤º
                    if (document.getElementById('inventory').classList.contains('active')) {
                        displayInventory();
                    }
                    
                    // æ›´æ–°ç­›é€‰ä¸‹æ‹‰é€‰é¡¹
                    updateFilterOptions();
                }, 1500);
            });
        }
        
        // é‡ç½®ç¼–è¾‘è¡¨å•
        function resetEditForm() {
            document.getElementById('edit-strain').value = '';
            document.getElementById('edit-factory').value = '';
            document.getElementById('edit-building').value = '';
            document.getElementById('edit-week-age').value = '';
            document.getElementById('edit-egg-count').value = '';
            document.getElementById('edit-select-range').value = '';
            document.getElementById('edit-start-lay-time').value = '';
            document.getElementById('edit-end-lay-time').value = '';
            document.getElementById('edit-receive-time').value = '';
            document.getElementById('edit-select-time').value = '';
            document.getElementById('edit-embryo-activation').value = '';
            document.getElementById('edit-remarks').value = '';
            document.getElementById('edit-message').style.display = 'none';
            currentEditIndex = -1;
        }
        
        // æ‰“å¼€ç¼–è¾‘æ¨¡æ€æ¡†
        function openEditModal(index) {
            currentEditIndex = index;
            const item = eggInventory[index];
            
            // å¡«å……è¡¨å•
            document.getElementById('edit-batch-id-display').textContent = item.batchId;
            document.getElementById('edit-strain').value = item.strain;
            document.getElementById('edit-factory').value = item.factory;
            document.getElementById('edit-building').value = item.building === 'æœªå¡«å†™' ? '' : item.building;
            document.getElementById('edit-week-age').value = item.weekAge === 'æœªå¡«å†™' ? '' : item.weekAge;
            document.getElementById('edit-egg-count').value = item.eggCount;
            document.getElementById('edit-select-range').value = item.selectRange === 'æœªå¡«å†™' ? '' : item.selectRange;
            document.getElementById('edit-start-lay-time').value = item.startLayTime === 'æœªå¡«å†™' ? '' : item.startLayTime;
            document.getElementById('edit-end-lay-time').value = item.endLayTime === 'æœªå¡«å†™' ? '' : item.endLayTime;
            document.getElementById('edit-receive-time').value = item.receiveTime === 'æœªå¡«å†™' ? '' : item.receiveTime;
            document.getElementById('edit-select-time').value = item.selectTime === 'æœªå¡«å†™' ? '' : item.selectTime;
            document.getElementById('edit-embryo-activation').value = item.embryoActivation;
            document.getElementById('edit-remarks').value = item.remarks === 'æ— ' ? '' : item.remarks;
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            document.getElementById('edit-inventory-modal').classList.add('active');
        }
        
        // åˆå§‹åŒ–å‡ºåº“å­—æ®µéªŒè¯
        function initOutboundFieldValidation() {
            // ä¸ºæ‰€æœ‰æ‰¹æ¬¡å·è¾“å…¥æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬
            document.querySelectorAll('.batch-input').forEach(input => {
                input.addEventListener('input', function() {
                    const unitNumber = this.id.split('-').pop();
                    const countInput = document.getElementById(`outbound-egg-count-${unitNumber}`);
                    const incubatorInput = document.getElementById(`incubator-number-${unitNumber}`);
                    
                    if (this.value.trim() === '') {
                        // æ‰¹æ¬¡å·ä¸ºç©ºï¼Œè§£é™¤å¿…å¡«
                        countInput.removeAttribute('required');
                        incubatorInput.removeAttribute('required');
                    } else {
                        // æ‰¹æ¬¡å·ä¸ä¸ºç©ºï¼Œè®¾ç½®ä¸ºå¿…å¡«
                        countInput.setAttribute('required', 'required');
                        incubatorInput.setAttribute('required', 'required');
                    }
                });
            });
        }
        
        // åˆå§‹åŒ–åˆ é™¤é€‰ä¸­è®°å½•åŠŸèƒ½
        function initDeleteSelectedRecords() {
            // åº“å­˜ä¿¡æ¯åˆ é™¤é€‰ä¸­æŒ‰é’®
            const deleteSelectedInventoryBtn = document.getElementById('delete-selected-inventory-btn');
            deleteSelectedInventoryBtn.addEventListener('click', function() {
                deleteSelectedRecords('inventory');
            });
            
            // å‡ºåº“è®°å½•åˆ é™¤é€‰ä¸­æŒ‰é’®
            const deleteSelectedOutboundBtn = document.getElementById('delete-selected-outbound-btn');
            deleteSelectedOutboundBtn.addEventListener('click', function() {
                deleteSelectedRecords('outbound');
            });
        }
        
        // åˆ é™¤é€‰ä¸­è®°å½•
        function deleteSelectedRecords(type) {
            const checkboxes = document.querySelectorAll(`.${type}-checkbox:checked`);
            
            if (checkboxes.length === 0) {
                alert('è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è®°å½•ï¼');
                return;
            }
            
            if (!confirm(`ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${checkboxes.length} æ¡è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)) {
                return;
            }
            
            const password = prompt('è¯·è¾“å…¥åˆ é™¤å¯†ç ï¼ˆé»˜è®¤å¯†ç ï¼š0000ï¼‰ï¼š');
            if (password !== '0000') {
                alert('å¯†ç é”™è¯¯ï¼Œæ“ä½œå·²å–æ¶ˆï¼');
                return;
            }
            
            // æ”¶é›†è¦åˆ é™¤çš„æ‰¹æ¬¡å·
            const batchIdsToDelete = [];
            checkboxes.forEach(checkbox => {
                batchIdsToDelete.push(checkbox.value);
            });
            
            if (type === 'inventory') {
                // åˆ é™¤åº“å­˜è®°å½•
                eggInventory = eggInventory.filter(item => !batchIdsToDelete.includes(item.batchId));
                saveToLocalStorage();
                displayInventory();
            } else if (type === 'outbound') {
                // åˆ é™¤å‡ºåº“è®°å½•
                outboundRecords = outboundRecords.filter(record => !batchIdsToDelete.includes(record.batchId));
                saveOutboundRecordsToLocalStorage();
                displayOutboundRecords();
            }
            
            // æ›´æ–°çœ‹æ¿
            updateDashboard();
            
            // æ›´æ–°ç­›é€‰ä¸‹æ‹‰é€‰é¡¹
            updateFilterOptions();
            
            alert(`æˆåŠŸåˆ é™¤ ${batchIdsToDelete.length} æ¡è®°å½•ï¼`);
        }
        
        // å…¥åº“åŠŸèƒ½
        function initInboundForm() {
            const inboundSubmitBtn = document.getElementById('inbound-submit');
            const inboundResetBtn = document.getElementById('inbound-reset');
            const inboundPassword = document.getElementById('inbound-password');
            const inboundMessage = document.getElementById('inbound-message');
            const regenerateBtn = document.getElementById('regenerate-batch-id');
            
            // é‡æ–°ç”Ÿæˆæ‰¹æ¬¡å·æŒ‰é’®
            regenerateBtn.addEventListener('click', function() {
                generateBatchId();
                showMessage(inboundMessage, 'æ‰¹æ¬¡å·å·²é‡æ–°ç”Ÿæˆ', 'success');
            });
            
            inboundSubmitBtn.addEventListener('click', function() {
                // éªŒè¯å¯†ç 
                if (inboundPassword.value !== '0') {
                    showMessage(inboundMessage, 'å¯†ç é”™è¯¯ï¼è¯·æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®ã€‚', 'error');
                    return;
                }
                
                // è·å–è¡¨å•æ•°æ®
                const batchId = document.getElementById('batch-id').value.trim();
                const strain = document.getElementById('strain').value.trim();
                const factory = document.getElementById('factory').value.trim();
                const building = document.getElementById('building').value.trim();
                const weekAge = document.getElementById('week-age').value.trim();
                const eggCount = document.getElementById('egg-count').value.trim();
                const selectRange = document.getElementById('select-range').value.trim();
                const startLayTime = document.getElementById('start-lay-time').value;
                const endLayTime = document.getElementById('end-lay-time').value;
                const receiveTime = document.getElementById('receive-time').value;
                let selectTime = document.getElementById('select-time').value;
                const embryoActivation = document.getElementById('embryo-activation').value;
                const remarks = document.getElementById('remarks').value.trim();
                
                // éªŒè¯å¿…å¡«å­—æ®µ
                if (!batchId || !strain || !factory || !eggCount || !receiveTime || !startLayTime || embryoActivation === '') {
                    showMessage(inboundMessage, 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼ˆå¸¦*å·ï¼‰ï¼', 'error');
                    return;
                }
                
                // æ£€æŸ¥æ‰¹æ¬¡å·æ˜¯å¦å·²å­˜åœ¨
                const existingBatch = eggInventory.find(item => item.batchId === batchId);
                if (existingBatch) {
                    showMessage(inboundMessage, `æ‰¹æ¬¡å· ${batchId} å·²å­˜åœ¨ï¼è¯·ä½¿ç”¨ä¸åŒçš„æ‰¹æ¬¡å·ã€‚`, 'error');
                    return;
                }
                
                // å¦‚æœé€‰è›‹æ—¥æœŸä¸ºç©ºï¼Œè®¾ç½®ä¸ºå½“å‰æ—¥æœŸ
                if (!selectTime) {
                    const today = new Date().toISOString().split('T')[0];
                    selectTime = today;
                }
                
                // è®¡ç®—å­˜è›‹å¤©æ•°ï¼ˆä»èµ·å§‹äº§è›‹æ—¥æœŸåˆ°å½“å¤©ï¼‰
                const storageDays = calculateStorageDays(startLayTime);
                
                // åˆ›å»ºæ–°çš„åº“å­˜è®°å½•
                const newItem = {
                    batchId,
                    strain,
                    factory,
                    building: building || 'æœªå¡«å†™',
                    weekAge: weekAge || 'æœªå¡«å†™',
                    eggCount: parseInt(eggCount),
                    selectRange: selectRange || 'æœªå¡«å†™',
                    startLayTime: startLayTime || 'æœªå¡«å†™',
                    endLayTime: endLayTime || 'æœªå¡«å†™',
                    receiveTime: receiveTime || 'æœªå¡«å†™',
                    selectTime: selectTime || 'æœªå¡«å†™',
                    embryoActivation: parseInt(embryoActivation),
                    remarks: remarks || 'æ— ',
                    storageDays: storageDays,
                    inboundDate: new Date().toISOString().split('T')[0]
                };
                
                // æ·»åŠ åˆ°åº“å­˜æ•°ç»„
                eggInventory.push(newItem);
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveToLocalStorage();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                const activationText = getActivationText(newItem.embryoActivation);
                showMessage(inboundMessage, `æ‰¹æ¬¡ ${batchId} å…¥åº“æˆåŠŸï¼æ•°é‡ï¼š${eggCount}ä¸ªï¼Œèƒšèƒæ¿€æ´»æ¬¡æ•°ï¼š${activationText}`, 'success');
                
                // é‡ç½®è¡¨å•å¹¶ç”Ÿæˆæ–°æ‰¹æ¬¡å·
                resetInboundForm();
                generateBatchId();
                
                // æ›´æ–°çœ‹æ¿
                updateDashboard();
                
                // æ›´æ–°åº“å­˜æ˜¾ç¤º
                if (document.getElementById('inventory').classList.contains('active')) {
                    displayInventory();
                }
                
                // æ›´æ–°ç­›é€‰ä¸‹æ‹‰é€‰é¡¹
                updateFilterOptions();
            });
            
            inboundResetBtn.addEventListener('click', resetInboundForm);
        }
        
        // è·å–èƒšèƒæ¿€æ´»æ¬¡æ•°æ–‡æœ¬
        function getActivationText(activationCount) {
            const activationMap = {
                0: '0æ¬¡ (0-7å¤©)',
                1: '1æ¬¡ (8-11å¤©)',
                2: '2æ¬¡ (12-14å¤©)',
                3: '3æ¬¡ (15-21å¤©)'
            };
            return activationMap[activationCount] || activationCount + 'æ¬¡';
        }
        
        // é‡ç½®å…¥åº“è¡¨å•
        function resetInboundForm() {
            document.getElementById('strain').value = '';
            document.getElementById('factory').value = '';
            document.getElementById('building').value = '';
            document.getElementById('week-age').value = '';
            document.getElementById('egg-count').value = '7560'; // é‡ç½®ä¸ºé»˜è®¤å€¼7560
            document.getElementById('select-range').value = '';
            document.getElementById('start-lay-time').value = '';
            document.getElementById('end-lay-time').value = '';
            document.getElementById('receive-time').value = '';
            document.getElementById('select-time').value = '';
            document.getElementById('embryo-activation').value = '0'; // é‡ç½®ä¸ºé»˜è®¤å€¼0æ¬¡
            document.getElementById('remarks').value = '';
            
            // è®¾ç½®èµ·å§‹äº§è›‹æ—¥æœŸä¸º7å¤©å‰
            const sevenDaysAgo = new Date();
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            document.getElementById('start-lay-time').value = sevenDaysAgo.toISOString().split('T')[0];
            
            // è®¾ç½®é€‰è›‹æ—¥æœŸä¸ºå½“å‰æ—¥æœŸ
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('select-time').value = today;
            
            // æ¸…é™¤æ¶ˆæ¯
            document.getElementById('inbound-message').style.display = 'none';
        }
        
        // å‡ºåº“åŠŸèƒ½
        function initOutboundForm() {
            const outboundSubmitBtn = document.getElementById('outbound-submit');
            const clearOutboundFieldsBtn = document.getElementById('clear-outbound-fields');
            const outboundPassword = document.getElementById('outbound-password');
            const outboundMessage = document.getElementById('outbound-message');
            
            // æ¸…ç©ºå‡ºåº“å­—æ®µæŒ‰é’®
            clearOutboundFieldsBtn.addEventListener('click', function() {
                for (let i = 1; i <= 4; i++) {
                    document.getElementById(`outbound-batch-id-${i}`).value = '';
                    document.getElementById(`outbound-egg-count-${i}`).value = '';
                    document.getElementById(`incubator-number-${i}`).value = '';
                }
                showMessage(outboundMessage, 'æ‰€æœ‰å‡ºåº“å­—æ®µå·²æ¸…ç©º', 'success');
            });
            
            outboundSubmitBtn.addEventListener('click', function() {
                // éªŒè¯å¯†ç 
                if (outboundPassword.value !== '0') {
                    showMessage(outboundMessage, 'å¯†ç é”™è¯¯ï¼è¯·æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®ã€‚', 'error');
                    return;
                }
                
                // æ”¶é›†æ‰€æœ‰å‡ºåº“å•å…ƒçš„æ•°æ®
                const outboundUnits = [];
                let hasValidUnit = false;
                
                for (let i = 1; i <= 4; i++) {
                    const batchId = document.getElementById(`outbound-batch-id-${i}`).value.trim();
                    const outboundCount = document.getElementById(`outbound-egg-count-${i}`).value.trim();
                    const incubatorNumber = document.getElementById(`incubator-number-${i}`).value.trim();
                    
                    // å¦‚æœæ‰¹æ¬¡å·ä¸ºç©ºï¼Œè·³è¿‡è¯¥å•å…ƒ
                    if (!batchId) {
                        continue;
                    }
                    
                    hasValidUnit = true;
                    
                    // éªŒè¯å¿…å¡«å­—æ®µ
                    if (!outboundCount || outboundCount <= 0 || !incubatorNumber) {
                        showMessage(outboundMessage, `ç¬¬${i}ä¸ªå‡ºåº“å•å…ƒï¼šè¯·è¾“å…¥æœ‰æ•ˆçš„å‡ºåº“æ•°é‡å’Œå­µåŒ–æœºå·ï¼`, 'error');
                        return;
                    }
                    
                    // æŸ¥æ‰¾æ‰¹æ¬¡
                    const batchIndex = eggInventory.findIndex(item => item.batchId === batchId);
                    if (batchIndex === -1) {
                        showMessage(outboundMessage, `ç¬¬${i}ä¸ªå‡ºåº“å•å…ƒï¼šæ‰¹æ¬¡å· ${batchId} ä¸å­˜åœ¨ï¼`, 'error');
                        return;
                    }
                    
                    // æ£€æŸ¥åº“å­˜æ•°é‡
                    const count = parseInt(outboundCount);
                    if (eggInventory[batchIndex].eggCount < count) {
                        showMessage(outboundMessage, `ç¬¬${i}ä¸ªå‡ºåº“å•å…ƒï¼šå‡ºåº“æ•°é‡è¶…è¿‡åº“å­˜ï¼å½“å‰åº“å­˜ï¼š${eggInventory[batchIndex].eggCount}ä¸ª`, 'error');
                        return;
                    }
                    
                    outboundUnits.push({
                        unitNumber: i,
                        batchId: batchId,
                        batchIndex: batchIndex,
                        outboundCount: count,
                        incubatorNumber: incubatorNumber
                    });
                }
                
                // å¦‚æœæ²¡æœ‰æœ‰æ•ˆçš„å‡ºåº“å•å…ƒ
                if (!hasValidUnit) {
                    showMessage(outboundMessage, 'è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªæœ‰æ•ˆçš„å‡ºåº“æ‰¹æ¬¡å·ï¼', 'error');
                    return;
                }
                
                // å¤„ç†æ‰€æœ‰å‡ºåº“å•å…ƒ
                let successCount = 0;
                const currentDate = new Date().toISOString().split('T')[0];
                
                outboundUnits.forEach(unit => {
                    const { batchId, batchIndex, outboundCount, incubatorNumber } = unit;
                    
                    // è·å–å½“å‰æ—¥æœŸ
                    const outboundDate = currentDate;
                    
                    // é‡æ–°è®¡ç®—å­˜è›‹å¤©æ•°ï¼ˆç”¨äºå‡ºåº“è®°å½•ï¼‰
                    const storageDays = calculateStorageDays(eggInventory[batchIndex].startLayTime);
                    
                    // åˆ›å»ºå‡ºåº“è®°å½•
                    const outboundRecord = {
                        ...eggInventory[batchIndex],
                        outboundCount,
                        incubatorNumber,
                        outboundDate,
                        originalCount: eggInventory[batchIndex].eggCount + outboundCount,
                        remainingCount: eggInventory[batchIndex].eggCount - outboundCount,
                        storageDays: storageDays
                    };
                    
                    // æ·»åŠ åˆ°å‡ºåº“è®°å½•
                    outboundRecords.push(outboundRecord);
                    
                    // æ›´æ–°åº“å­˜æ•°é‡
                    eggInventory[batchIndex].eggCount -= outboundCount;
                    
                    // æ›´æ–°åº“å­˜è®°å½•çš„å­˜è›‹å¤©æ•°
                    eggInventory[batchIndex].storageDays = storageDays;
                    
                    // å¦‚æœåº“å­˜ä¸º0ï¼Œä»åº“å­˜ä¸­ç§»é™¤
                    if (eggInventory[batchIndex].eggCount === 0) {
                        eggInventory.splice(batchIndex, 1);
                    }
                    
                    successCount++;
                });
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveToLocalStorage();
                saveOutboundRecordsToLocalStorage();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showMessage(outboundMessage, `æˆåŠŸå¤„ç† ${successCount} ä¸ªæ‰¹æ¬¡å‡ºåº“ï¼`, 'success');
                
                // æ¸…ç©ºæ‰€æœ‰å‡ºåº“å­—æ®µ
                clearOutboundFieldsBtn.click();
                
                // æ›´æ–°çœ‹æ¿
                updateDashboard();
                
                // æ›´æ–°åº“å­˜æ˜¾ç¤º
                if (document.getElementById('inventory').classList.contains('active')) {
                    displayInventory();
                }
                
                // å¦‚æœæŸ¥è¯¢ç»“æœæ­£åœ¨æ˜¾ç¤ºï¼Œæ›´æ–°å®ƒ
                updateSearchResult();
                
                // å¦‚æœå‡ºåº“è®°å½•é¡µé¢æ­£åœ¨æ˜¾ç¤ºï¼Œæ›´æ–°å®ƒ
                if (document.getElementById('outbound-records').classList.contains('active')) {
                    displayOutboundRecords();
                }
                
                // æ›´æ–°ç­›é€‰ä¸‹æ‹‰é€‰é¡¹
                updateFilterOptions();
            });
        }
        
        // æœç´¢åŠŸèƒ½
        function initSearch() {
            const searchBtn = document.getElementById('search-btn');
            const resetSearchBtn = document.getElementById('reset-search');
            const inventorySearchBtn = document.getElementById('inventory-search-btn');
            const inventoryResetSearchBtn = document.getElementById('inventory-reset-search');
            const refreshInventoryBtn = document.getElementById('refresh-inventory-btn');
            
            searchBtn.addEventListener('click', function() {
                const searchTerm = document.getElementById('search-batch').value.trim();
                updateSearchResult(searchTerm);
            });
            
            resetSearchBtn.addEventListener('click', function() {
                document.getElementById('search-batch').value = '';
                updateSearchResult('');
            });
            
            inventorySearchBtn.addEventListener('click', function() {
                const searchDate = document.getElementById('inventory-search-date').value;
                const searchStrain = document.getElementById('inventory-search-strain').value;
                const searchFactory = document.getElementById('inventory-search-factory').value.trim();
                const searchActivation = document.getElementById('inventory-search-activation').value;
                const searchSelectRange = document.getElementById('inventory-search-select-range').value.trim();
                const searchStorageDays = document.getElementById('inventory-search-storage-days').value.trim();
                
                displayInventory('', searchDate, searchStrain, searchFactory, searchActivation, searchSelectRange, searchStorageDays);
            });
            
            inventoryResetSearchBtn.addEventListener('click', function() {
                document.getElementById('inventory-search-date').value = '';
                document.getElementById('inventory-search-strain').value = '';
                document.getElementById('inventory-search-factory').value = '';
                document.getElementById('inventory-search-activation').value = '';
                document.getElementById('inventory-search-select-range').value = '';
                document.getElementById('inventory-search-storage-days').value = '';
                
                displayInventory();
            });
            
            refreshInventoryBtn.addEventListener('click', function() {
                displayInventory();
                showMessage(document.getElementById('inventory').querySelector('.message'), 'åº“å­˜æ•°æ®å·²åˆ·æ–°', 'success');
            });
        }
        
        // åˆå§‹åŒ–å‡ºåº“è®°å½•åŠŸèƒ½
        function initOutboundRecords() {
            const outboundSearchBtn = document.getElementById('outbound-search-btn');
            const outboundResetSearchBtn = document.getElementById('outbound-reset-search');
            
            outboundSearchBtn.addEventListener('click', function() {
                const batchId = document.getElementById('outbound-search-batch').value.trim();
                const strain = document.getElementById('outbound-search-strain').value;
                const factory = document.getElementById('outbound-search-factory').value.trim();
                const activation = document.getElementById('outbound-search-activation').value;
                
                displayOutboundRecords(batchId, strain, factory, activation);
            });
            
            outboundResetSearchBtn.addEventListener('click', function() {
                document.getElementById('outbound-search-batch').value = '';
                document.getElementById('outbound-search-strain').value = '';
                document.getElementById('outbound-search-factory').value = '';
                document.getElementById('outbound-search-activation').value = '';
                
                displayOutboundRecords();
            });
        }
        
        // åˆå§‹åŒ–é‡æ–°å…¥åº“æ¨¡æ€æ¡†
        function initReimportModal() {
            const showReimportModalBtn = document.getElementById('show-reimport-modal');
            const closeReimportModalBtn = document.getElementById('close-reimport-modal');
            const cancelReimportBtn = document.getElementById('cancel-reimport');
            const reimportModal = document.getElementById('reimport-modal');
            const reimportSubmitBtn = document.getElementById('reimport-submit');
            const reimportPassword = document.getElementById('reimport-password');
            const reimportMessage = document.getElementById('reimport-message');
            
            // æ˜¾ç¤ºæ¨¡æ€æ¡†
            showReimportModalBtn.addEventListener('click', function() {
                reimportModal.classList.add('active');
            });
            
            // å…³é—­æ¨¡æ€æ¡†
            closeReimportModalBtn.addEventListener('click', function() {
                reimportModal.classList.remove('active');
                resetReimportForm();
            });
            
            cancelReimportBtn.addEventListener('click', function() {
                reimportModal.classList.remove('active');
                resetReimportForm();
            });
            
            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            reimportModal.addEventListener('click', function(e) {
                if (e.target === reimportModal) {
                    reimportModal.classList.remove('active');
                    resetReimportForm();
                }
            });
            
            // æäº¤é‡æ–°å…¥åº“
            reimportSubmitBtn.addEventListener('click', function() {
                // éªŒè¯å¯†ç 
                if (reimportPassword.value !== '0') {
                    showMessage(reimportMessage, 'å¯†ç é”™è¯¯ï¼è¯·æ£€æŸ¥å¯†ç æ˜¯å¦æ­£ç¡®ã€‚', 'error');
                    return;
                }
                
                // è·å–è¡¨å•æ•°æ®
                const batchId = document.getElementById('reimport-batch-id').value.trim();
                const eggCount = document.getElementById('reimport-egg-count').value.trim();
                const embryoActivation = document.getElementById('reimport-embryo-activation').value;
                const remarks = document.getElementById('reimport-remarks').value.trim();
                
                // éªŒè¯å¿…å¡«å­—æ®µ
                if (!batchId || !eggCount || embryoActivation === '') {
                    showMessage(reimportMessage, 'è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µï¼', 'error');
                    return;
                }
                
                // æ£€æŸ¥å‡ºåº“è®°å½•ä¸­æ˜¯å¦å­˜åœ¨è¯¥æ‰¹æ¬¡
                const outboundRecordIndex = outboundRecords.findIndex(record => record.batchId === batchId);
                if (outboundRecordIndex === -1) {
                    showMessage(reimportMessage, `æ‰¹æ¬¡å· ${batchId} ä¸å­˜åœ¨äºå‡ºåº“è®°å½•ä¸­ï¼`, 'error');
                    return;
                }
                
                const outboundRecord = outboundRecords[outboundRecordIndex];
                const count = parseInt(eggCount);
                
                // æ£€æŸ¥é‡æ–°å…¥åº“æ•°é‡æ˜¯å¦åˆç†
                if (count <= 0) {
                    showMessage(reimportMessage, 'é‡æ–°å…¥åº“æ•°é‡å¿…é¡»å¤§äº0ï¼', 'error');
                    return;
                }
                
                if (count > outboundRecord.outboundCount) {
                    showMessage(reimportMessage, `é‡æ–°å…¥åº“æ•°é‡ä¸èƒ½è¶…è¿‡åŸå‡ºåº“æ•°é‡ ${outboundRecord.outboundCount}ï¼`, 'error');
                    return;
                }
                
                // åˆ›å»ºæ–°çš„åº“å­˜è®°å½•ï¼ˆåŸºäºå‡ºåº“è®°å½•ï¼‰
                const newItem = {
                    batchId: outboundRecord.batchId,
                    strain: outboundRecord.strain,
                    factory: outboundRecord.factory,
                    building: outboundRecord.building,
                    weekAge: outboundRecord.weekAge,
                    eggCount: count,
                    selectRange: outboundRecord.selectRange,
                    startLayTime: outboundRecord.startLayTime,
                    endLayTime: outboundRecord.endLayTime,
                    receiveTime: outboundRecord.receiveTime,
                    selectTime: outboundRecord.selectTime,
                    embryoActivation: parseInt(embryoActivation), // ä½¿ç”¨é‡æ–°é€‰æ‹©çš„æ¿€æ´»æ¬¡æ•°
                    remarks: remarks || `é‡æ–°å…¥åº“ï¼ŒåŸå¤‡æ³¨ï¼š${outboundRecord.remarks}`,
                    storageDays: calculateStorageDays(outboundRecord.startLayTime),
                    inboundDate: new Date().toISOString().split('T')[0]
                };
                
                // æ·»åŠ åˆ°åº“å­˜æ•°ç»„
                eggInventory.push(newItem);
                
                // æ›´æ–°å‡ºåº“è®°å½•ä¸­çš„å‡ºåº“æ•°é‡
                outboundRecord.outboundCount -= count;
                outboundRecord.remainingCount = outboundRecord.originalCount - outboundRecord.outboundCount;
                
                // å¦‚æœå‡ºåº“æ•°é‡å˜ä¸º0ï¼Œä»å‡ºåº“è®°å½•ä¸­ç§»é™¤
                if (outboundRecord.outboundCount === 0) {
                    outboundRecords.splice(outboundRecordIndex, 1);
                }
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveToLocalStorage();
                saveOutboundRecordsToLocalStorage();
                
                // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                showMessage(reimportMessage, `æ‰¹æ¬¡ ${batchId} é‡æ–°å…¥åº“æˆåŠŸï¼æ•°é‡ï¼š${count}ä¸ªï¼Œèƒšèƒæ¿€æ´»æ¬¡æ•°ï¼š${getActivationText(parseInt(embryoActivation))}`, 'success');
                
                // é‡ç½®è¡¨å•å¹¶å…³é—­æ¨¡æ€æ¡†
                setTimeout(() => {
                    reimportModal.classList.remove('active');
                    resetReimportForm();
                    
                    // æ›´æ–°çœ‹æ¿
                    updateDashboard();
                    
                    // æ›´æ–°åº“å­˜æ˜¾ç¤º
                    if (document.getElementById('inventory').classList.contains('active')) {
                        displayInventory();
                    }
                    
                    // æ›´æ–°å‡ºåº“è®°å½•æ˜¾ç¤º
                    if (document.getElementById('outbound-records').classList.contains('active')) {
                        displayOutboundRecords();
                    }
                    
                    // æ›´æ–°ç­›é€‰ä¸‹æ‹‰é€‰é¡¹
                    updateFilterOptions();
                }, 1500);
            });
        }
        
        // é‡ç½®é‡æ–°å…¥åº“è¡¨å•
        function resetReimportForm() {
            document.getElementById('reimport-batch-id').value = '';
            document.getElementById('reimport-egg-count').value = '';
            document.getElementById('reimport-embryo-activation').value = '';
            document.getElementById('reimport-remarks').value = '';
            document.getElementById('reimport-password').value = '';
            document.getElementById('reimport-message').style.display = 'none';
        }
        
        // æ›´æ–°æŸ¥è¯¢ç»“æœ
        function updateSearchResult(searchTerm = '') {
            const searchResult = document.getElementById('search-result');
            
            if (!searchTerm) {
                searchResult.innerHTML = '<p>è¯·è¾“å…¥æ‰¹æ¬¡å·è¿›è¡ŒæŸ¥è¯¢</p>';
                return;
            }
            
            const filteredItems = eggInventory.filter(item => 
                item.batchId.includes(searchTerm)
            );
            
            if (filteredItems.length === 0) {
                searchResult.innerHTML = `<p>æœªæ‰¾åˆ°æ‰¹æ¬¡å·åŒ…å« "${searchTerm}" çš„ç§è›‹è®°å½•</p>`;
                return;
            }
            
            let html = `<h4>æŸ¥è¯¢ç»“æœï¼ˆ${filteredItems.length}æ¡è®°å½•ï¼‰</h4>`;
            html += '<table>';
            html += '<tr><th>æ‰¹æ¬¡å·</th><th>å“ç³»</th><th>åˆ†å‚</th><th>æ ‹èˆ</th><th>å‘¨é¾„</th><th>åº“å­˜æ•°é‡</th><th>èƒšèƒæ¿€æ´»æ¬¡æ•°</th><th>å­˜è›‹å¤©æ•°</th><th>æ¥æ”¶æ—¥æœŸ</th><th>æ“ä½œ</th></tr>';
            
            filteredItems.forEach(item => {
                // é‡æ–°è®¡ç®—å­˜è›‹å¤©æ•°ï¼ˆç¡®ä¿æ˜¾ç¤ºæœ€æ–°æ•°æ®ï¼‰
                const storageDays = calculateStorageDays(item.startLayTime);
                const storageClass = getStorageDaysClass(storageDays);
                
                html += `
                <tr>
                    <td>${item.batchId}</td>
                    <td>${item.strain}</td>
                    <td>${item.factory}</td>
                    <td>${item.building}</td>
                    <td>${item.weekAge}</td>
                    <td>${item.eggCount}</td>
                    <td>${getActivationText(item.embryoActivation)}</td>
                    <td><span class="${storageClass}">${storageDays}å¤©</span></td>
                    <td>${formatDate(item.receiveTime)}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small" onclick="fillOutboundForm('${item.batchId}', ${item.eggCount})">å¿«é€Ÿå‡ºåº“</button>
                        </div>
                    </td>
                </tr>
                `;
            });
            
            html += '</table>';
            searchResult.innerHTML = html;
        }
        
        // å¿«é€Ÿå¡«å……å‡ºåº“è¡¨å•
        function fillOutboundForm(batchId, maxCount) {
            // æ‰¾åˆ°ç¬¬ä¸€ä¸ªç©ºçš„å‡ºåº“å•å…ƒ
            for (let i = 1; i <= 4; i++) {
                const batchInput = document.getElementById(`outbound-batch-id-${i}`);
                if (!batchInput.value.trim()) {
                    batchInput.value = batchId;
                    document.getElementById(`outbound-egg-count-${i}`).value = maxCount;
                    document.getElementById(`outbound-egg-count-${i}`).setAttribute('max', maxCount);
                    
                    // æ»šåŠ¨åˆ°å‡ºåº“åŒºåŸŸ
                    document.querySelector('.nav-btn[data-target="outbound"]').click();
                    
                    // æ»šåŠ¨åˆ°è¯¥å‡ºåº“å•å…ƒ
                    setTimeout(() => {
                        batchInput.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        batchInput.focus();
                    }, 100);
                    
                    break;
                }
            }
        }
        
        // æ˜¾ç¤ºåº“å­˜ä¿¡æ¯ - ä¿®æ”¹å‡½æ•°ä»¥æ”¯æŒæŒ‰é€‰è›‹èŒƒå›´ç­›é€‰å¹¶æ·»åŠ ä¿®æ”¹æŒ‰é’®å’Œå¤é€‰æ¡†
        function displayInventory(searchTerm = '', searchDate = '', searchStrain = '', searchFactory = '', searchActivation = '', searchSelectRange = '', searchStorageDays = '') {
            const inventoryResult = document.getElementById('inventory-result');
            
            if (eggInventory.length === 0) {
                inventoryResult.innerHTML = `
                <div class="empty-state">
                    <div style="font-size: 2.8rem; margin-bottom: 14px;">ğŸ¥š</div>
                    <h3>åº“å­˜ä¸ºç©º</h3>
                    <p>æš‚æ— ç§è›‹åº“å­˜è®°å½•ï¼Œè¯·å…ˆè¿›è¡Œå…¥åº“æ“ä½œ</p>
                </div>
                `;
                return;
            }
            
            let filteredItems = eggInventory;
            
            // æŒ‰æ‰¹æ¬¡å·ç­›é€‰
            if (searchTerm) {
                filteredItems = filteredItems.filter(item => 
                    item.batchId.includes(searchTerm)
                );
            }
            
            // æŒ‰é€‰è›‹æ—¥æœŸç­›é€‰
            if (searchDate) {
                filteredItems = filteredItems.filter(item => 
                    item.selectTime === searchDate
                );
            }
            
            // æŒ‰å“ç³»ç­›é€‰
            if (searchStrain) {
                filteredItems = filteredItems.filter(item => 
                    item.strain === searchStrain
                );
            }
            
            // æŒ‰åˆ†å‚ç­›é€‰
            if (searchFactory) {
                filteredItems = filteredItems.filter(item => 
                    item.factory.includes(searchFactory)
                );
            }
            
            // æŒ‰èƒšèƒæ¿€æ´»æ¬¡æ•°ç­›é€‰
            if (searchActivation !== '') {
                filteredItems = filteredItems.filter(item => 
                    item.embryoActivation === parseInt(searchActivation)
                );
            }
            
            // æŒ‰é€‰è›‹èŒƒå›´ç­›é€‰
            if (searchSelectRange) {
                filteredItems = filteredItems.filter(item => 
                    item.selectRange.includes(searchSelectRange)
                );
            }
            
            // æŒ‰å­˜è›‹å¤©æ•°ç­›é€‰
            if (searchStorageDays) {
                const targetDays = parseInt(searchStorageDays);
                if (!isNaN(targetDays)) {
                    filteredItems = filteredItems.filter(item => {
                        // é‡æ–°è®¡ç®—å­˜è›‹å¤©æ•°ä»¥ç¡®ä¿å‡†ç¡®æ€§
                        const storageDays = calculateStorageDays(item.startLayTime);
                        // å¦‚æœå­˜å‚¨çš„å¤©æ•°ä¸æ˜¯æ•°å­—ï¼Œåˆ™æ’é™¤
                        if (typeof storageDays !== 'number' || isNaN(storageDays)) {
                            return false;
                        }
                        // ç²¾ç¡®åŒ¹é…å­˜è›‹å¤©æ•°
                        return storageDays === targetDays;
                    });
                }
            }
            
            if (filteredItems.length === 0) {
                inventoryResult.innerHTML = `<p>æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„ç§è›‹è®°å½•</p>`;
                return;
            }
            
            let html = `<h3>åº“å­˜æ‰¹æ¬¡ä¿¡æ¯ï¼ˆå…±<span class="data-count">${filteredItems.length}</span>ä¸ªæ‰¹æ¬¡ï¼‰</h3>`;
            html += '<div class="table-scroll-container">';
            html += '<table>';
            html += '<tr><th><input type="checkbox" class="select-all-checkbox-header" id="select-all-inventory-header"></th><th>æ‰¹æ¬¡å·</th><th>å“ç³»</th><th>åˆ†å‚</th><th>æ ‹èˆ</th><th>å‘¨é¾„</th><th>ç§è›‹æ•°é‡</th><th>é€‰è›‹èŒƒå›´</th><th>èµ·å§‹äº§è›‹æ—¥æœŸ</th><th>ç»“æŸäº§è›‹æ—¥æœŸ</th><th>èƒšèƒæ¿€æ´»æ¬¡æ•°</th><th>å­˜è›‹å¤©æ•°</th><th>æ¥æ”¶æ—¥æœŸ</th><th>é€‰è›‹æ—¥æœŸ</th><th>å¤‡æ³¨</th><th>æ“ä½œ</th></tr>';
            
            filteredItems.forEach((item, index) => {
                // æ‰¾åˆ°åŸæ•°ç»„ä¸­çš„ç´¢å¼•
                const originalIndex = eggInventory.findIndex(inv => inv.batchId === item.batchId);
                
                // é‡æ–°è®¡ç®—å­˜è›‹å¤©æ•°ï¼ˆç¡®ä¿æ˜¾ç¤ºæœ€æ–°æ•°æ®ï¼‰
                const storageDays = calculateStorageDays(item.startLayTime);
                const storageClass = getStorageDaysClass(storageDays);
                
                html += `
                <tr>
                    <td><input type="checkbox" class="inventory-checkbox" value="${item.batchId}"></td>
                    <td>${item.batchId}</td>
                    <td>${item.strain}</td>
                    <td>${item.factory}</td>
                    <td>${item.building}</td>
                    <td>${item.weekAge}</td>
                    <td>${item.eggCount}</td>
                    <td>${item.selectRange}</td>
                    <td>${formatDate(item.startLayTime)}</td>
                    <td>${formatDate(item.endLayTime)}</td>
                    <td>${getActivationText(item.embryoActivation)}</td>
                    <td><span class="${storageClass} storage-days">${storageDays}å¤©</span></td>
                    <td>${formatDate(item.receiveTime)}</td>
                    <td>${formatDate(item.selectTime)}</td>
                    <td>${item.remarks}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small" onclick="fillOutboundForm('${item.batchId}', ${item.eggCount})">å‡ºåº“</button>
                            <button class="btn btn-warning btn-small" onclick="openEditModal(${originalIndex})">ä¿®æ”¹</button>
                        </div>
                    </td>
                </tr>
                `;
            });
            
            html += '</table>';
            html += '</div>'; // å…³é—­.table-scroll-container
            inventoryResult.innerHTML = html;
            
            // æ·»åŠ å…¨é€‰åŠŸèƒ½
            const selectAllHeaderCheckbox = document.getElementById('select-all-inventory-header');
            const inventoryCheckboxes = document.querySelectorAll('.inventory-checkbox');
            
            if (selectAllHeaderCheckbox) {
                selectAllHeaderCheckbox.addEventListener('change', function() {
                    const isChecked = this.checked;
                    inventoryCheckboxes.forEach(checkbox => {
                        checkbox.checked = isChecked;
                    });
                });
            }
            
            // å•ä¸ªå¤é€‰æ¡†ç‚¹å‡»æ—¶æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
            inventoryCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateSelectAllCheckboxState('inventory');
                });
            });
        }
        
        // æ˜¾ç¤ºå‡ºåº“è®°å½• - æ·»åŠ å¤é€‰æ¡†å’Œæ›´å¤šå­—æ®µ
        function displayOutboundRecords(batchId = '', strain = '', factory = '', activation = '') {
            const outboundRecordsResult = document.getElementById('outbound-records-result');
            
            if (outboundRecords.length === 0) {
                outboundRecordsResult.innerHTML = `
                <div class="empty-state">
                    <div style="font-size: 2.8rem; margin-bottom: 14px;">ğŸ“¤</div>
                    <h3>å‡ºåº“è®°å½•ä¸ºç©º</h3>
                    <p>æš‚æ— ç§è›‹å‡ºåº“è®°å½•</p>
                </div>
                `;
                return;
            }
            
            let filteredRecords = outboundRecords;
            
            // æŒ‰æ‰¹æ¬¡å·ç­›é€‰
            if (batchId) {
                filteredRecords = filteredRecords.filter(record => 
                    record.batchId.includes(batchId)
                );
            }
            
            // æŒ‰å“ç³»ç­›é€‰
            if (strain) {
                filteredRecords = filteredRecords.filter(record => 
                    record.strain === strain
                );
            }
            
            // æŒ‰åˆ†å‚ç­›é€‰
            if (factory) {
                filteredRecords = filteredRecords.filter(record => 
                    record.factory.includes(factory)
                );
            }
            
            // æŒ‰èƒšèƒæ¿€æ´»æ¬¡æ•°ç­›é€‰
            if (activation !== '') {
                filteredRecords = filteredRecords.filter(record => 
                    record.embryoActivation === parseInt(activation)
                );
            }
            
            if (filteredRecords.length === 0) {
                outboundRecordsResult.innerHTML = `<p>æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å‡ºåº“è®°å½•</p>`;
                return;
            }
            
            let html = `<h3>å‡ºåº“è®°å½•ï¼ˆå…±<span class="data-count">${filteredRecords.length}</span>æ¡ï¼‰</h3>`;
            html += '<div class="outbound-table-scroll-container">';
            html += '<table>';
            html += '<tr><th><input type="checkbox" class="select-all-checkbox-header" id="select-all-outbound-header"></th><th>æ‰¹æ¬¡å·</th><th>å“ç³»</th><th>åˆ†å‚</th><th>æ ‹èˆ</th><th>å‘¨é¾„</th><th>é€‰è›‹èŒƒå›´</th><th>èµ·å§‹äº§è›‹æ—¥æœŸ</th><th>ç»“æŸäº§è›‹æ—¥æœŸ</th><th>æ¥æ”¶æ—¥æœŸ</th><th>é€‰è›‹æ—¥æœŸ</th><th>èƒšèƒæ¿€æ´»æ¬¡æ•°</th><th>åŸæ•°é‡</th><th>å‡ºåº“æ•°é‡</th><th>å‰©ä½™æ•°é‡</th><th>å­µåŒ–æœºå·</th><th>å­˜è›‹å¤©æ•°</th><th>å‡ºåº“æ—¥æœŸ</th><th>å¤‡æ³¨</th><th>æ“ä½œ</th></tr>';
            
            filteredRecords.forEach(record => {
                const storageClass = getStorageDaysClass(record.storageDays);
                
                html += `
                <tr>
                    <td><input type="checkbox" class="outbound-checkbox" value="${record.batchId}"></td>
                    <td>${record.batchId}</td>
                    <td>${record.strain}</td>
                    <td>${record.factory}</td>
                    <td>${record.building}</td>
                    <td>${record.weekAge}</td>
                    <td>${record.selectRange}</td>
                    <td>${formatDate(record.startLayTime)}</td>
                    <td>${formatDate(record.endLayTime)}</td>
                    <td>${formatDate(record.receiveTime)}</td>
                    <td>${formatDate(record.selectTime)}</td>
                    <td>${getActivationText(record.embryoActivation)}</td>
                    <td>${record.originalCount}</td>
                    <td>${record.outboundCount}</td>
                    <td>${record.remainingCount || 0}</td>
                    <td>${record.incubatorNumber}</td>
                    <td><span class="${storageClass}">${record.storageDays}å¤©</span></td>
                    <td>${formatDate(record.outboundDate)}</td>
                    <td>${record.remarks}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-success btn-small" onclick="fillReimportForm('${record.batchId}', ${record.outboundCount})">é‡æ–°å…¥åº“</button>
                        </div>
                    </td>
                </tr>
                `;
            });
            
            html += '</table>';
            html += '</div>'; // å…³é—­.outbound-table-scroll-container
            outboundRecordsResult.innerHTML = html;
            
            // æ·»åŠ å…¨é€‰åŠŸèƒ½
            const selectAllHeaderCheckbox = document.getElementById('select-all-outbound-header');
            const outboundCheckboxes = document.querySelectorAll('.outbound-checkbox');
            
            if (selectAllHeaderCheckbox) {
                selectAllHeaderCheckbox.addEventListener('change', function() {
                    const isChecked = this.checked;
                    outboundCheckboxes.forEach(checkbox => {
                        checkbox.checked = isChecked;
                    });
                });
            }
            
            // å•ä¸ªå¤é€‰æ¡†ç‚¹å‡»æ—¶æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
            outboundCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateSelectAllCheckboxState('outbound');
                });
            });
        }
        
        // æ›´æ–°å…¨é€‰æ¡†çŠ¶æ€
        function updateSelectAllCheckboxState(type) {
            const checkboxes = document.querySelectorAll(`.${type}-checkbox`);
            const selectAllHeaderCheckbox = document.getElementById(`select-all-${type}-header`);
            
            if (checkboxes.length === 0) return;
            
            const allChecked = Array.from(checkboxes).every(checkbox => checkbox.checked);
            
            if (selectAllHeaderCheckbox) {
                selectAllHeaderCheckbox.checked = allChecked;
                selectAllHeaderCheckbox.indeterminate = !allChecked && Array.from(checkboxes).some(checkbox => checkbox.checked);
            }
        }
        
        // å¡«å……é‡æ–°å…¥åº“è¡¨å•
        function fillReimportForm(batchId, maxCount) {
            const reimportModal = document.getElementById('reimport-modal');
            reimportModal.classList.add('active');
            
            document.getElementById('reimport-batch-id').value = batchId;
            document.getElementById('reimport-egg-count').value = maxCount;
            document.getElementById('reimport-egg-count').setAttribute('max', maxCount);
            
            // è®¾ç½®é»˜è®¤èƒšèƒæ¿€æ´»æ¬¡æ•°ä¸º0
            document.getElementById('reimport-embryo-activation').value = '0';
            
            // æ»šåŠ¨åˆ°æ¨¡æ€æ¡†
            setTimeout(() => {
                document.getElementById('reimport-batch-id').focus();
            }, 100);
        }
        
        // æ¸…ç©ºæ•°æ®åŠŸèƒ½
        function initClearData() {
            const clearDataBtn = document.getElementById('clear-data-btn');
            
            clearDataBtn.addEventListener('click', function() {
                const password = prompt('è¯·è¾“å…¥æ¸…ç©ºæ•°æ®çš„å¯†ç ï¼ˆé»˜è®¤å¯†ç ï¼š0000ï¼‰ï¼š');
                if (password === '0000') {
                    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                        eggInventory = [];
                        outboundRecords = [];
                        localStorage.removeItem('eggInventoryData');
                        localStorage.removeItem('outboundRecordsData');
                        localStorage.removeItem('eggSystemBackup');
                        updateDashboard();
                        displayInventory();
                        displayOutboundRecords();
                        updateFilterOptions();
                        alert('æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼');
                    }
                } else {
                    alert('å¯†ç é”™è¯¯ï¼Œæ“ä½œå·²å–æ¶ˆï¼');
                }
            });
        }
        
        // åˆå§‹åŒ–å¯¼å‡ºæŒ‰é’®
        function initExportButtons() {
            // åº“å­˜æ•°æ®å¯¼å‡º
            const exportInventoryBtn = document.getElementById('export-inventory-btn');
            exportInventoryBtn.addEventListener('click', function() {
                exportToExcel(eggInventory, 'ç§è›‹åº“å­˜æ•°æ®');
            });
            
            // å‡ºåº“è®°å½•å¯¼å‡º
            const exportOutboundBtn = document.getElementById('export-outbound-btn');
            exportOutboundBtn.addEventListener('click', function() {
                exportToExcel(outboundRecords, 'ç§è›‹å‡ºåº“è®°å½•');
            });
        }
        
        // å¯¼å‡ºæ•°æ®ä¸ºExcel
        function exportToExcel(data, filename) {
            if (data.length === 0) {
                alert('æ²¡æœ‰æ•°æ®å¯ä»¥å¯¼å‡ºï¼');
                return;
            }
            
            try {
                // å‡†å¤‡æ•°æ®
                const worksheetData = [];
                
                // æ·»åŠ è¡¨å¤´
                const headers = Object.keys(data[0]);
                worksheetData.push(headers);
                
                // æ·»åŠ æ•°æ®è¡Œ
                data.forEach(item => {
                    const row = headers.map(header => {
                        if (header === 'embryoActivation') {
                            return getActivationText(item[header]);
                        }
                        return item[header];
                    });
                    worksheetData.push(row);
                });
                
                // åˆ›å»ºå·¥ä½œç°¿å’Œå·¥ä½œè¡¨
                const workbook = XLSX.utils.book_new();
                const worksheet = XLSX.utils.aoa_to_sheet(worksheetData);
                
                // å°†å·¥ä½œè¡¨æ·»åŠ åˆ°å·¥ä½œç°¿
                XLSX.utils.book_append_sheet(workbook, worksheet, 'Sheet1');
                
                // ç”ŸæˆExcelæ–‡ä»¶å¹¶ä¸‹è½½
                XLSX.writeFile(workbook, `${filename}_${new Date().toISOString().split('T')[0]}.xlsx`);
                
                alert(`æ•°æ®å·²æˆåŠŸå¯¼å‡ºä¸º${filename}.xlsx`);
            } catch (error) {
                console.error('å¯¼å‡ºExcelæ—¶å‡ºé”™:', error);
                alert('å¯¼å‡ºæ•°æ®æ—¶å‡ºé”™ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼æˆ–é‡è¯•ã€‚');
            }
        }
        
        // æ›´æ–°çœ‹æ¿ - æ·»åŠ åº“å­˜æ•°é‡é¢œè‰²æç¤º
        function updateDashboard() {
            // è®¡ç®—å„å“ç³»åº“å­˜æ€»é‡
            const strainCounts = {
                'æµ·å…°è¤': 0,
                'æµ·å…°ç™½': 0,
                'æµ·å…°ç²‰': 0,
                'æµ·å…°ç°': 0
            };
            
            eggInventory.forEach(item => {
                if (strainCounts.hasOwnProperty(item.strain)) {
                    strainCounts[item.strain] += item.eggCount;
                }
            });
            
            // æ›´æ–°æ€»åº“å­˜
            const totalInventory = eggInventory.reduce((sum, item) => sum + item.eggCount, 0);
            const totalInventoryElement = document.getElementById('totalInventory');
            totalInventoryElement.textContent = totalInventory.toLocaleString();
            
            // æ ¹æ®åº“å­˜æ•°é‡è®¾ç½®é¢œè‰²å’Œæç¤º
            const totalCard = document.querySelector('.total-card');
            let alertText = '';
            let alertClass = '';
            
            if (totalInventory > 1260000) {
                // åº“å­˜è¿‡å¤š
                totalCard.style.borderTopColor = '#ff4757';
                totalCard.querySelector('.value').style.color = '#ff4757';
                alertText = 'åº“å­˜è¿‡å¤š';
                alertClass = 'high';
            } else if (totalInventory < 720000) {
                // åº“å­˜ä¸è¶³
                totalCard.style.borderTopColor = '#ff4757';
                totalCard.querySelector('.value').style.color = '#ff4757';
                alertText = 'åº“å­˜ä¸è¶³';
                alertClass = 'low';
            } else {
                // åº“å­˜æ­£å¸¸
                totalCard.style.borderTopColor = '#2ed573';
                totalCard.querySelector('.value').style.color = '#2ed573';
                alertText = 'åº“å­˜æ­£å¸¸';
                alertClass = 'normal';
            }
            
            // æ·»åŠ æˆ–æ›´æ–°æç¤ºæ–‡æœ¬
            let alertElement = totalCard.querySelector('.inventory-alert');
            if (!alertElement) {
                alertElement = document.createElement('span');
                alertElement.className = 'inventory-alert';
                totalCard.querySelector('.subtitle').appendChild(alertElement);
            }
            alertElement.textContent = alertText;
            alertElement.className = 'inventory-alert ' + alertClass;
            
            // æ›´æ–°å„å“ç³»åº“å­˜å¡ç‰‡
            document.getElementById('hailanBrownCount').textContent = strainCounts['æµ·å…°è¤'].toLocaleString();
            document.getElementById('hailanWhiteCount').textContent = strainCounts['æµ·å…°ç™½'].toLocaleString();
            document.getElementById('hailanPinkCount').textContent = strainCounts['æµ·å…°ç²‰'].toLocaleString();
            document.getElementById('hailanGrayCount').textContent = strainCounts['æµ·å…°ç°'].toLocaleString();
            
            // æ›´æ–°å›¾è¡¨
            updateStrainChart();
            updateFactoryChart();
            updateActivationChart();
            updateTrendChart();
        }
        
        // æ›´æ–°å“ç³»å›¾è¡¨ - æŸ±çŠ¶å›¾
        function updateStrainChart() {
            const strainData = {};
            eggInventory.forEach(item => {
                if (!strainData[item.strain]) {
                    strainData[item.strain] = 0;
                }
                strainData[item.strain] += item.eggCount;
            });
            
            const strains = Object.keys(strainData);
            const counts = Object.values(strainData);
            
            const ctx = document.getElementById('strainChart').getContext('2d');
            
            // é”€æ¯ç°æœ‰å›¾è¡¨å®ä¾‹
            if (window.strainChart instanceof Chart) {
                window.strainChart.destroy();
            }
            
            // ç”Ÿæˆé¢œè‰²æ•°ç»„
            const colors = generateColors(strains.length);
            
            window.strainChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: strains,
                    datasets: [{
                        label: 'ç§è›‹æ•°é‡',
                        data: counts,
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.8', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'å„å“ç³»ç§è›‹åº“å­˜é‡'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç§è›‹æ•°é‡'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'å“ç³»'
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°åˆ†å‚å›¾è¡¨ - æŸ±çŠ¶å›¾
        function updateFactoryChart() {
            const factoryData = {};
            eggInventory.forEach(item => {
                if (!factoryData[item.factory]) {
                    factoryData[item.factory] = 0;
                }
                factoryData[item.factory] += item.eggCount;
            });
            
            const factories = Object.keys(factoryData);
            const counts = Object.values(factoryData);
            
            const ctx = document.getElementById('factoryChart').getContext('2d');
            
            // é”€æ¯ç°æœ‰å›¾è¡¨å®ä¾‹
            if (window.factoryChart instanceof Chart) {
                window.factoryChart.destroy();
            }
            
            // ç”Ÿæˆé¢œè‰²æ•°ç»„
            const colors = generateColors(factories.length, true);
            
            window.factoryChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: factories,
                    datasets: [{
                        label: 'ç§è›‹æ•°é‡',
                        data: counts,
                        backgroundColor: colors,
                        borderColor: colors.map(color => color.replace('0.8', '1')),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'å„åˆ†å‚ç§è›‹åº“å­˜é‡'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç§è›‹æ•°é‡'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'åˆ†å‚'
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°èƒšèƒæ¿€æ´»æ¬¡æ•°åˆ†å¸ƒå›¾è¡¨ - åˆ†ç»„æŸ±çŠ¶å›¾
        function updateActivationChart() {
            // æŒ‰èƒšèƒæ¿€æ´»æ¬¡æ•°å’Œå“ç³»åˆ†ç»„
            const activationGroups = {
                0: { 'æµ·å…°è¤': 0, 'æµ·å…°ç²‰': 0, 'æµ·å…°ç°': 0, 'æµ·å…°ç™½': 0 },
                1: { 'æµ·å…°è¤': 0, 'æµ·å…°ç²‰': 0, 'æµ·å…°ç°': 0, 'æµ·å…°ç™½': 0 },
                2: { 'æµ·å…°è¤': 0, 'æµ·å…°ç²‰': 0, 'æµ·å…°ç°': 0, 'æµ·å…°ç™½': 0 },
                3: { 'æµ·å…°è¤': 0, 'æµ·å…°ç²‰': 0, 'æµ·å…°ç°': 0, 'æµ·å…°ç™½': 0 }
            };
            
            eggInventory.forEach(item => {
                const activation = item.embryoActivation;
                const strain = item.strain;
                if (activationGroups[activation] && activationGroups[activation][strain] !== undefined) {
                    activationGroups[activation][strain] += item.eggCount;
                }
            });
            
            const labels = ['0æ¬¡ (0-7å¤©)', '1æ¬¡ (8-11å¤©)', '2æ¬¡ (12-14å¤©)', '3æ¬¡ (15-21å¤©)'];
            const strains = ['æµ·å…°è¤', 'æµ·å…°ç²‰', 'æµ·å…°ç°', 'æµ·å…°ç™½'];
            
            const ctx = document.getElementById('activationChart').getContext('2d');
            
            // é”€æ¯ç°æœ‰å›¾è¡¨å®ä¾‹
            if (window.activationChart instanceof Chart) {
                window.activationChart.destroy();
            }
            
            // ä¸åŒå“ç³»çš„é¢œè‰²
            const strainColors = ['#6A89CC', '#4A69BD', '#1E3799', '#0C2461'];
            
            // å‡†å¤‡æ•°æ®é›†
            const datasets = strains.map((strain, index) => {
                const data = [0, 1, 2, 3].map(activation => 
                    activationGroups[activation][strain] || 0
                );
                
                return {
                    label: strain,
                    data: data,
                    backgroundColor: strainColors[index] + 'CC',
                    borderColor: strainColors[index],
                    borderWidth: 1
                };
            });
            
            window.activationChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'èƒšèƒæ¿€æ´»æ¬¡æ•°åˆ†å¸ƒ'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç§è›‹æ•°é‡'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'èƒšèƒæ¿€æ´»æ¬¡æ•°'
                            }
                        }
                    }
                }
            });
        }
        
        // æ›´æ–°å…¥åº“/å‡ºåº“è¶‹åŠ¿å›¾è¡¨ - æŠ˜çº¿å›¾
        function updateTrendChart() {
            // è·å–æœ€è¿‘7å¤©çš„æ—¥æœŸ
            const dates = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
            }
            
            // ç»Ÿè®¡å…¥åº“æ•°é‡
            const inboundData = dates.map(date => {
                const items = eggInventory.filter(item => item.inboundDate === date);
                return items.reduce((sum, item) => sum + item.eggCount, 0);
            });
            
            // ç»Ÿè®¡å‡ºåº“æ•°é‡
            const outboundData = dates.map(date => {
                const items = outboundRecords.filter(item => item.outboundDate === date);
                return items.reduce((sum, item) => sum + item.outboundCount, 0);
            });
            
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            // é”€æ¯ç°æœ‰å›¾è¡¨å®ä¾‹
            if (window.trendChart instanceof Chart) {
                window.trendChart.destroy();
            }
            
            // ç®€åŒ–æ—¥æœŸæ˜¾ç¤º
            const displayDates = dates.map(date => {
                const d = new Date(date);
                return `${d.getMonth()+1}/${d.getDate()}`;
            });
            
            window.trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: displayDates,
                    datasets: [
                        {
                            label: 'å…¥åº“æ•°é‡',
                            data: inboundData,
                            borderColor: '#2ed573',
                            backgroundColor: 'rgba(46, 213, 115, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        },
                        {
                            label: 'å‡ºåº“æ•°é‡',
                            data: outboundData,
                            borderColor: '#ff4757',
                            backgroundColor: 'rgba(255, 71, 87, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        title: {
                            display: true,
                            text: 'è¿‘7å¤©å…¥åº“/å‡ºåº“è¶‹åŠ¿'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç§è›‹æ•°é‡'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'æ—¥æœŸ'
                            }
                        }
                    }
                }
            });
        }
        
        // è¾…åŠ©å‡½æ•°
        function saveToLocalStorage() {
            localStorage.setItem('eggInventoryData', JSON.stringify(eggInventory));
        }
        
        function saveOutboundRecordsToLocalStorage() {
            localStorage.setItem('outboundRecordsData', JSON.stringify(outboundRecords));
        }
        
        function showMessage(element, message, type) {
            element.textContent = message;
            element.className = `message ${type}`;
            element.style.display = 'block';
            
            // 3ç§’åè‡ªåŠ¨éšè—æ¶ˆæ¯
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }
        
        function formatDate(dateString) {
            if (!dateString || dateString === 'æœªå¡«å†™') {
                return 'æœªå¡«å†™';
            }
            
            const date = new Date(dateString);
            if (isNaN(date.getTime())) {
                return dateString;
            }
            
            return date.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit'
            });
        }
        
        function generateColors(count, isFactory = false) {
            const baseColors = isFactory ? 
                ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'] :
                ['#6A89CC', '#4A69BD', '#1E3799', '#0C2461', '#82CCDD', '#60A3BC', '#3C6382', '#0A3D62', '#B8E994', '#78E08F'];
            
            const colors = [];
            for (let i = 0; i < count; i++) {
                colors.push(baseColors[i % baseColors.length] + 'CC'); // æ·»åŠ é€æ˜åº¦
            }
            return colors;
        }
        
        // 2. åˆå§‹åŒ–æ•°æ®å¤‡ä»½å’Œæ¢å¤åŠŸèƒ½
        function initBackupFunctions() {
            const backupDataBtn = document.getElementById('backup-data-btn');
            const restoreDataBtn = document.getElementById('restore-data-btn');
            const exportJsonBtn = document.getElementById('export-json-btn');
            const importJsonBtn = document.getElementById('import-json-btn');
            const importJsonFile = document.getElementById('import-json-file');
            
            // å¤‡ä»½å½“å‰æ•°æ®
            backupDataBtn.addEventListener('click', function() {
                const password = prompt('è¯·è¾“å…¥å¤‡ä»½å¯†ç ï¼ˆé»˜è®¤å¯†ç ï¼š0000ï¼‰ï¼š');
                if (password !== '0000') {
                    alert('å¯†ç é”™è¯¯ï¼Œå¤‡ä»½æ“ä½œå·²å–æ¶ˆï¼');
                    return;
                }
                
                const backupData = {
                    eggInventory: eggInventory,
                    outboundRecords: outboundRecords,
                    backupDate: new Date().toISOString(),
                    backupVersion: '1.0'
                };
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨çš„å¤‡ä»½åŒºåŸŸ
                localStorage.setItem('eggSystemBackup', JSON.stringify(backupData));
                
                alert(`æ•°æ®å¤‡ä»½æˆåŠŸï¼å¤‡ä»½æ—¶é—´ï¼š${new Date().toLocaleString()}\nå¤‡ä»½äº† ${eggInventory.length} æ¡åº“å­˜è®°å½•å’Œ ${outboundRecords.length} æ¡å‡ºåº“è®°å½•ã€‚`);
            });
            
            // ä»å¤‡ä»½æ¢å¤æ•°æ®
            restoreDataBtn.addEventListener('click', function() {
                const password = prompt('è¯·è¾“å…¥æ¢å¤å¯†ç ï¼ˆé»˜è®¤å¯†ç ï¼š0000ï¼‰ï¼š');
                if (password !== '0000') {
                    alert('å¯†ç é”™è¯¯ï¼Œæ¢å¤æ“ä½œå·²å–æ¶ˆï¼');
                    return;
                }
                
                const backupData = localStorage.getItem('eggSystemBackup');
                if (!backupData) {
                    alert('æ²¡æœ‰æ‰¾åˆ°å¤‡ä»½æ•°æ®ï¼');
                    return;
                }
                
                if (!confirm('è­¦å‘Šï¼šæ¢å¤å¤‡ä»½å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                    return;
                }
                
                try {
                    const backup = JSON.parse(backupData);
                    
                    // éªŒè¯å¤‡ä»½æ•°æ®ç»“æ„
                    if (!backup.eggInventory || !backup.outboundRecords) {
                        alert('å¤‡ä»½æ•°æ®æ ¼å¼é”™è¯¯ï¼');
                        return;
                    }
                    
                    // æ¢å¤æ•°æ®
                    eggInventory = backup.eggInventory;
                    outboundRecords = backup.outboundRecords;
                    
                    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                    saveToLocalStorage();
                    saveOutboundRecordsToLocalStorage();
                    
                    // æ›´æ–°ç•Œé¢
                    updateDashboard();
                    displayInventory();
                    displayOutboundRecords();
                    updateFilterOptions();
                    
                    alert(`æ•°æ®æ¢å¤æˆåŠŸï¼æ¢å¤äº† ${eggInventory.length} æ¡åº“å­˜è®°å½•å’Œ ${outboundRecords.length} æ¡å‡ºåº“è®°å½•ã€‚\nå¤‡ä»½æ—¶é—´ï¼š${backup.backupDate ? new Date(backup.backupDate).toLocaleString() : 'æœªçŸ¥'}`);
                } catch (error) {
                    console.error('æ¢å¤æ•°æ®æ—¶å‡ºé”™:', error);
                    alert('æ¢å¤æ•°æ®æ—¶å‡ºé”™ï¼Œå¤‡ä»½æ–‡ä»¶å¯èƒ½å·²æŸåï¼');
                }
            });
            
            // å¯¼å‡ºä¸ºJSONæ–‡ä»¶
            exportJsonBtn.addEventListener('click', function() {
                const dataToExport = {
                    eggInventory: eggInventory,
                    outboundRecords: outboundRecords,
                    exportDate: new Date().toISOString(),
                    exportVersion: '1.0'
                };
                
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `è›‹åº“ç³»ç»Ÿæ•°æ®å¤‡ä»½_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                alert(`æ•°æ®å·²å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼å¯¼å‡ºäº† ${eggInventory.length} æ¡åº“å­˜è®°å½•å’Œ ${outboundRecords.length} æ¡å‡ºåº“è®°å½•ã€‚`);
            });
            
            // ä»JSONæ–‡ä»¶å¯¼å…¥ - ä¿®å¤ç‰ˆ
            importJsonBtn.addEventListener('click', function() {
                const password = prompt('è¯·è¾“å…¥å¯¼å…¥å¯†ç ï¼ˆé»˜è®¤å¯†ç ï¼š0000ï¼‰ï¼š');
                if (password !== '0000') {
                    alert('å¯†ç é”™è¯¯ï¼Œå¯¼å…¥æ“ä½œå·²å–æ¶ˆï¼');
                    return;
                }
                
                if (!confirm('è­¦å‘Šï¼šå¯¼å…¥JSONæ–‡ä»¶å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                    return;
                }
                
                // ç›´æ¥è§¦å‘æ–‡ä»¶è¾“å…¥æ¡†çš„ç‚¹å‡»äº‹ä»¶
                importJsonFile.click();
            });
            
            // å¤„ç†æ–‡ä»¶é€‰æ‹© - ä¿®å¤ç‰ˆ
            importJsonFile.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (!file) {
                    alert('æœªé€‰æ‹©æ–‡ä»¶ï¼');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const importedData = JSON.parse(event.target.result);
                        
                        // éªŒè¯å¯¼å…¥çš„æ•°æ®ç»“æ„
                        if (!importedData.eggInventory || !Array.isArray(importedData.eggInventory)) {
                            alert('å¯¼å…¥çš„JSONæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘eggInventoryæ•°ç»„ï¼');
                            return;
                        }
                        
                        if (!importedData.outboundRecords || !Array.isArray(importedData.outboundRecords)) {
                            alert('å¯¼å…¥çš„JSONæ–‡ä»¶æ ¼å¼é”™è¯¯ï¼šç¼ºå°‘outboundRecordsæ•°ç»„ï¼');
                            return;
                        }
                        
                        // å¯¼å…¥æ•°æ®
                        eggInventory = importedData.eggInventory;
                        outboundRecords = importedData.outboundRecords;
                        
                        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                        saveToLocalStorage();
                        saveOutboundRecordsToLocalStorage();
                        
                        // æ›´æ–°ç•Œé¢
                        updateDashboard();
                        displayInventory();
                        displayOutboundRecords();
                        updateFilterOptions();
                        
                        // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
                        importJsonFile.value = '';
                        
                        alert(`æ•°æ®å¯¼å…¥æˆåŠŸï¼å¯¼å…¥äº† ${eggInventory.length} æ¡åº“å­˜è®°å½•å’Œ ${outboundRecords.length} æ¡å‡ºåº“è®°å½•ã€‚`);
                    } catch (error) {
                        console.error('å¯¼å…¥JSONæ–‡ä»¶æ—¶å‡ºé”™:', error);
                        alert('å¯¼å…¥JSONæ–‡ä»¶æ—¶å‡ºé”™ï¼š' + error.message + '\nè¯·ç¡®ä¿æ–‡ä»¶æ ¼å¼æ­£ç¡®ã€‚');
                    }
                };
                
                reader.onerror = function() {
                    alert('è¯»å–æ–‡ä»¶æ—¶å‡ºé”™ï¼Œè¯·ç¡®ä¿æ–‡ä»¶æœªæŸåã€‚');
                };
                
                reader.readAsText(file);
            });
        }
        
        // 3. æ›´æ–°ç­›é€‰ä¸‹æ‹‰é€‰é¡¹ï¼ˆåŒ…æ‹¬åˆ†å‚å’Œé€‰è›‹èŒƒå›´ï¼‰
        function updateFilterOptions() {
            // è·å–åº“å­˜ä¸­çš„æ‰€æœ‰åˆ†å‚ï¼ˆå»é‡ï¼‰
            const factories = [...new Set(eggInventory.map(item => item.factory).filter(f => f && f !== 'æœªå¡«å†™'))];
            
            // è·å–åº“å­˜ä¸­çš„æ‰€æœ‰é€‰è›‹èŒƒå›´ï¼ˆå»é‡ï¼‰
            const selectRanges = [...new Set(eggInventory.map(item => item.selectRange).filter(r => r && r !== 'æœªå¡«å†™'))];
            
            // æ›´æ–°åº“å­˜ç­›é€‰ä¸­çš„åˆ†å‚ä¸‹æ‹‰é€‰é¡¹
            const inventoryFactorySelect = document.getElementById('inventory-search-factory');
            if (inventoryFactorySelect) {
                // ä¿å­˜å½“å‰é€‰ä¸­çš„å€¼
                const currentValue = inventoryFactorySelect.value;
                
                // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ª"å…¨éƒ¨"é€‰é¡¹ï¼‰
                while (inventoryFactorySelect.options.length > 1) {
                    inventoryFactorySelect.remove(1);
                }
                
                // æ·»åŠ æ–°é€‰é¡¹
                factories.forEach(factory => {
                    const option = document.createElement('option');
                    option.value = factory;
                    option.textContent = factory;
                    inventoryFactorySelect.appendChild(option);
                });
                
                // æ¢å¤é€‰ä¸­çš„å€¼
                inventoryFactorySelect.value = currentValue;
            }
            
            // æ›´æ–°åº“å­˜ç­›é€‰ä¸­çš„é€‰è›‹èŒƒå›´ä¸‹æ‹‰é€‰é¡¹
            const inventorySelectRangeSelect = document.getElementById('inventory-search-select-range');
            if (inventorySelectRangeSelect) {
                // ä¿å­˜å½“å‰é€‰ä¸­çš„å€¼
                const currentValue = inventorySelectRangeSelect.value;
                
                // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ª"å…¨éƒ¨"é€‰é¡¹ï¼‰
                while (inventorySelectRangeSelect.options.length > 1) {
                    inventorySelectRangeSelect.remove(1);
                }
                
                // æ·»åŠ æ–°é€‰é¡¹
                selectRanges.forEach(range => {
                    const option = document.createElement('option');
                    option.value = range;
                    option.textContent = range;
                    inventorySelectRangeSelect.appendChild(option);
                });
                
                // æ¢å¤é€‰ä¸­çš„å€¼
                inventorySelectRangeSelect.value = currentValue;
            }
            
            // æ›´æ–°å‡ºåº“è®°å½•ç­›é€‰ä¸­çš„åˆ†å‚ä¸‹æ‹‰é€‰é¡¹
            const outboundFactorySelect = document.getElementById('outbound-search-factory');
            if (outboundFactorySelect) {
                // ä¿å­˜å½“å‰é€‰ä¸­çš„å€¼
                const currentValue = outboundFactorySelect.value;
                
                // æ¸…ç©ºç°æœ‰é€‰é¡¹ï¼ˆä¿ç•™ç¬¬ä¸€ä¸ª"å…¨éƒ¨"é€‰é¡¹ï¼‰
                while (outboundFactorySelect.options.length > 1) {
                    outboundFactorySelect.remove(1);
                }
                
                // ä»å‡ºåº“è®°å½•ä¸­è·å–åˆ†å‚ï¼ˆå»é‡ï¼‰
                const outboundFactories = [...new Set(outboundRecords.map(record => record.factory).filter(f => f && f !== 'æœªå¡«å†™'))];
                
                // åˆå¹¶åº“å­˜å’Œå‡ºåº“è®°å½•ä¸­çš„åˆ†å‚
                const allFactories = [...new Set([...factories, ...outboundFactories])];
                
                // æ·»åŠ æ–°é€‰é¡¹
                allFactories.forEach(factory => {
                    const option = document.createElement('option');
                    option.value = factory;
                    option.textContent = factory;
                    outboundFactorySelect.appendChild(option);
                });
                
                // æ¢å¤é€‰ä¸­çš„å€¼
                outboundFactorySelect.value = currentValue;
            }
        }
        
        // åˆå§‹åŒ–åŠ è½½ç¤ºä¾‹æ•°æ®æŒ‰é’®
        function initExampleDataButton() {
            const loadExampleDataBtn = document.getElementById('load-example-data-btn');
            
            loadExampleDataBtn.addEventListener('click', function() {
                if (!confirm('åŠ è½½ç¤ºä¾‹æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰æ•°æ®ï¼ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
                    return;
                }
                
                const password = prompt('è¯·è¾“å…¥æ“ä½œå¯†ç ï¼ˆé»˜è®¤å¯†ç ï¼š0000ï¼‰ï¼š');
                if (password !== '0000') {
                    alert('å¯†ç é”™è¯¯ï¼Œæ“ä½œå·²å–æ¶ˆï¼');
                    return;
                }
                
                // åŠ è½½å†…ç½®æ•°æ®
                eggInventory = [...builtInData.eggInventory];
                outboundRecords = [...builtInData.outboundRecords];
                
                // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
                saveToLocalStorage();
                saveOutboundRecordsToLocalStorage();
                
                // æ›´æ–°ç•Œé¢
                updateDashboard();
                displayInventory();
                displayOutboundRecords();
                updateFilterOptions();
                
                alert('ç¤ºä¾‹æ•°æ®åŠ è½½æˆåŠŸï¼');
            });
        }
        
        // ä¸ºç¤ºä¾‹æ•°æ®æ·»åŠ ä¸€äº›åˆå§‹æ•°æ®ï¼ˆå¦‚æœåº“å­˜ä¸ºç©ºï¼‰
        function addExampleDataIfEmpty() {
            if (eggInventory.length === 0) {
                // è·å–å½“å‰æ—¥æœŸ
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                const todayDate = todayStr.replace(/-/g, '');
                
                // ç”Ÿæˆä¸åŒæ—¥æœŸçš„ç¤ºä¾‹æ•°æ®
                const exampleData = [
                    {
                        batchId: `${todayDate}-101`,
                        strain: 'æµ·å…°è¤',
                        factory: 'é’å››',
                        building: '1å·æ ‹èˆ',
                        weekAge: '28',
                        eggCount: 1200,
                        selectRange: '45-65g',
                        startLayTime: '2024-01-01',
                        endLayTime: '2024-01-05',
                        receiveTime: '2024-01-06',
                        selectTime: '2024-01-06',
                        embryoActivation: 0,
                        remarks: 'ç¬¬ä¸€æ‰¹ä¼˜è´¨ç§è›‹',
                        storageDays: calculateStorageDays('2024-01-01'),
                        inboundDate: '2024-01-06'
                    },
                    {
                        batchId: `${todayDate}-202`,
                        strain: 'æµ·å…°ç²‰',
                        factory: 'é’ä¸‰',
                        building: '2å·æ ‹èˆ',
                        weekAge: '32',
                        eggCount: 1500,
                        selectRange: '50-70g',
                        startLayTime: '2024-01-05',
                        endLayTime: '2024-01-10',
                        receiveTime: '2024-01-11',
                        selectTime: '2024-01-11',
                        embryoActivation: 1,
                        remarks: 'ç²‰è‰²å“ç³»ä¼˜è´¨è›‹',
                        storageDays: calculateStorageDays('2024-01-05'),
                        inboundDate: '2024-01-11'
                    },
                    {
                        batchId: `${todayDate}-303`,
                        strain: 'æµ·å…°ç°',
                        factory: 'é’äºŒ',
                        building: '3å·æ ‹èˆ',
                        weekAge: '30',
                        eggCount: 900,
                        selectRange: '48-68g',
                        startLayTime: '2024-01-08',
                        endLayTime: '2024-01-13',
                        receiveTime: '2024-01-14',
                        selectTime: '2024-01-14',
                        embryoActivation: 2,
                        remarks: 'ç°è‰²å“ç³»ï¼Œä¸­ç­‰å¤§å°',
                        storageDays: calculateStorageDays('2024-01-08'),
                        inboundDate: '2024-01-14'
                    },
                    {
                        batchId: `${todayDate}-404`,
                        strain: 'æµ·å…°ç™½',
                        factory: 'é’å››',
                        building: '4å·æ ‹èˆ',
                        weekAge: '26',
                        eggCount: 1100,
                        selectRange: '46-66g',
                        startLayTime: '2024-01-10',
                        endLayTime: '2024-01-15',
                        receiveTime: '2024-01-16',
                        selectTime: '2024-01-16',
                        embryoActivation: 3,
                        remarks: 'ç™½è‰²å“ç³»ï¼Œé€‚åˆå­µåŒ–',
                        storageDays: calculateStorageDays('2024-01-10'),
                        inboundDate: '2024-01-16'
                    }
                ];
                
                eggInventory.push(...exampleData);
                saveToLocalStorage();
                updateDashboard();
                displayInventory();
                updateFilterOptions();
                
                // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
                setTimeout(() => {
                    alert('ç³»ç»Ÿå·²åŠ è½½ç¤ºä¾‹æ•°æ®ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¿¡æ¯æµ‹è¯•ç³»ç»ŸåŠŸèƒ½ï¼š\n\n1. å…¥åº“/å‡ºåº“/é‡æ–°å…¥åº“å¯†ç ï¼š0\n2. æ¸…ç©ºæ•°æ®/å¤‡ä»½æ¢å¤å¯†ç ï¼š0000\n3. ç¤ºä¾‹æ‰¹æ¬¡å·ï¼š' + exampleData[0].batchId + '\n\næ‚¨å¯ä»¥é€šè¿‡æ¸…ç©ºæ•°æ®æŒ‰é’®æ¸…é™¤è¿™äº›ç¤ºä¾‹æ•°æ®ã€‚');
                }, 500);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥æ˜¯å¦éœ€è¦æ·»åŠ ç¤ºä¾‹æ•°æ®
        setTimeout(addExampleDataIfEmpty, 1000);
    </script>
</body>
</html>